(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{797:function(s,a,e){"use strict";e.r(a);var t=e(17),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"通过acme-sh开源工具申请泛解析ssl证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过acme-sh开源工具申请泛解析ssl证书"}},[s._v("#")]),s._v(" 通过acme.sh开源工具申请泛解析SSL证书")]),s._v(" "),e("h1",{attrs:{id:"前期准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[s._v("#")]),s._v(" 前期准备")]),s._v(" "),e("p",[s._v("1.域名")]),s._v(" "),e("p",[s._v("2.Linux云服务器（本文系统某讯云的Centos7），测试公网IP为：150.158.130.33")]),s._v(" "),e("p",[s._v("3.域名服务商的API Token，或者域名解析到申请SSL云服务器IP（实验项目： ssl.xgss.net）")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/sslzhegnshu.webp.jpg?aliyun",alt:"sslzhegnshu.webp"}})]),s._v(" "),e("h1",{attrs:{id:"安装acme-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装acme-sh"}},[s._v("#")]),s._v(" 安装acme.sh")]),s._v(" "),e("p",[s._v("普通用户和 root 用户都可以安装使用. 安装过程进行了以下几步:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# yum install socat -y\n\n# curl https://get.acme.sh | sh\n# curl https://get.acme.sh | sh -s email=my@example.com(zerossl.com注册的邮箱账号，在浏览器登录ZeroSSL之后可以看到证书)\n\n# 或者\n# wget -O- https://get.acme.sh | sh\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("国内的服务器下载github可能会比较慢，如果下载失败，可以多执行几次。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627113047199.png?aliyun",alt:"image-20220627113047199"}})]),s._v(" "),e("p",[s._v("1、把 acme.sh 安装到你的 home 目录下：~/.acme.sh/\n装过程不会污染已有的系统任何功能和文件, 所有的修改都限制在安装目录中: ~/.acme.sh/")]),s._v(" "),e("p",[s._v("2、并创建 一个 bash 的 alias, 方便你的使用: alias acme.sh=~/.acme.sh/acme.sh")]),s._v(" "),e("p",[s._v("3、自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书.")]),s._v(" "),e("p",[s._v("把 acme.sh 安装到你的 home 目录下:~/.acme.sh/并创建 一个 bash 的 alias, 方便你的使用:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("alias acme.sh=~/.acme.sh/acme.sh\necho 'alias acme.sh=~/.acme.sh/acme.sh' >>/etc/profile\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"常用命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --help     #获取帮助\nacme.sh --version  # 查看版本\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"关联-zerossl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关联-zerossl"}},[s._v("#")]),s._v(" 关联 ZeroSSL")]),s._v(" "),e("p",[s._v("目前 acme.sh 支持四个正式环境 CA，分别是 Let’s Encrypt、Buypass、ZeroSSL 和 SSL.com，默认使用 ZeroSSL，所以我们不用切换。如果不放心，可以设置一下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --set-default-ca --server zerossl\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"生成证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[s._v("#")]),s._v(" 生成证书")]),s._v(" "),e("p",[s._v("acme.sh 实现了 acme 协议支持的所有验证协议. 一般有两种方式验证: HTTP 和 DNS 验证。")]),s._v(" "),e("p",[s._v("如果有条件建议使用DNS验证，")]),s._v(" "),e("h1",{attrs:{id:"http认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http认证"}},[s._v("#")]),s._v(" HTTP认证")]),s._v(" "),e("p",[s._v("此方法"),e("strong",[s._v("好像不支持域名的泛解析")]),s._v("，笔者想泛解析做泛域名的认证，但一直不成功，不知道什么原因。")]),s._v(" "),e("h2",{attrs:{id:"域名解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#域名解析"}},[s._v("#")]),s._v(" 域名解析")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ssl.xgss.net A记录解析到 150.158.130.33\n只解析上面一条即可，因为只是为 ssl.xgss.net 申请证书，后面的解析是为了实验能否申请到多*.xgss.net的证书\nxgss.net A记录解析到 150.158.130.33\n*.xgss.net A记录解析到 150.158.130.33\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627164634187.png?aliyun",alt:"image-20220627164634187"}})]),s._v(" "),e("p",[s._v("配置http站点")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# mkdir -p /data/wwwroot/web/ssl.xgss.net/\n# echo 'hello SSL'> /data/wwwroot/web/ssl.xgss.net/index.html\n配置nginx站点\nserver {\n  listen       80;\n  access_log /dev/null;\n  error_log /dev/null;\n  server_name  ssl.xgss.net xgss.net;\n  root /data/wwwroot/web/ssl.xgss.net/;\n  location / {\n                index  index.html index.htm index.php;\n        }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("验证是否配置正常")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# curl http://ssl.xgss.net/\nhello SSL\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("http 方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证. 然后就可以生成证书了.")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh  --issue  -d mydomain.com -d www.mydomain.com  --webroot  /home/wwwroot/mydomain.com/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("只需要指定域名, 并指定域名所在的网站根目录. acme.sh 会全自动的生成验证文件, 并放到网站的根目录, 然后自动完成验证. 最后会聪明的删除验证文件. 整个过程没有任何副作用.")]),s._v(" "),e("p",[s._v("如果你用的 nginx服务器, 或者反代, acme.sh 还可以智能的从 nginx的配置中自动完成验证, 你不需要指定网站根目录:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --issue  -d mydomain.com   --nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("注意, 无论是 apache 还是 nginx 模式, acme.sh在完成验证之后, 会恢复到之前的状态, 都不会私自更改你本身的配置. 好处是你不用担心配置被搞坏, 也有一个缺点, 你需要自己配置 ssl 的配置, 否则只能成功生成证书, 你的网站还是无法访问https. 但是为了安全, 你还是自己手动改配置吧.")])]),s._v(" "),e("p",[s._v("如果你还没有运行任何 web 服务, "),e("strong",[s._v("80")]),s._v(" 端口是空闲的, 那么 "),e("strong",[s._v("acme.sh")]),s._v(" 还能假装自己是一个webserver, 临时听在"),e("strong",[s._v("80")]),s._v(" 端口, 完成验证:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh  --issue -d mydomain.com   --standalone\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v('https://app.zerossl.com/signup 使用邮箱注册一个账号，假设账号的邮箱为："XXXX@163.com"')]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# /root/.acme.sh/acme.sh --register-account -m XXXX@163.com\n[Mon Jun 27 13:37:27 CST 2022] No EAB credentials found for ZeroSSL, let's get one\n[Mon Jun 27 13:37:30 CST 2022] Registering account: https://acme.zerossl.com/v2/DV90\n[Mon Jun 27 13:37:38 CST 2022] Registered\n[Mon Jun 27 13:37:38 CST 2022] ACCOUNT_THUMBPRINT='*********************'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"申请证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#申请证书"}},[s._v("#")]),s._v(" 申请证书")]),s._v(" "),e("p",[s._v("将证书放到一个指定的目录，scrm用nginx配置，本例是指定在/data/wwwroot/web/ssl目录下")]),s._v(" "),e("h3",{attrs:{id:"_1-创建ssl存放目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建ssl存放目录"}},[s._v("#")]),s._v(" 1.创建ssl存放目录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir -p /data/wwwroot/web/ssl\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-申请ssl证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-申请ssl证书"}},[s._v("#")]),s._v(" 2.申请SSL证书")]),s._v(" "),e("p",[s._v("申请单域名证书，并且指定证书存放的目录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# /root/.acme.sh/acme.sh  --issue -d ssl.xgss.net  --webroot  /data/wwwroot/web/ssl.xgss.net/ \\\n--keypath       /data/wwwroot/web/ssl/ssl.xgss.net.key  \\\n--fullchainpath /data/wwwroot/web/ssl/ssl.xgss.net.key.pem \\\n--reloadcmd "/usr/local/openresty/nginx/sbin/nginx -s reload"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("--reloadcmd 表示复制完成后重启服务器的命令，根据自己服务器状况填写。")]),s._v(" "),e("p",[s._v("/data/wwwroot/web/ssl/ 需要自己建立好，如果文件夹不存在，会报错。")]),s._v(" "),e("h3",{attrs:{id:"_3-生成dhparam文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-生成dhparam文件"}},[s._v("#")]),s._v(" 3.生成dhparam文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl dhparam -out /data/wwwroot/web/ssl/dhparam.pem     2048         \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_4-配置ssl-xgss-net的nginx配置。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置ssl-xgss-net的nginx配置。"}},[s._v("#")]),s._v(" 4.配置ssl.xgss.net的nginx配置。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  server {\n        listen 443 ssl;\n\t\taccess_log /dev/null;\n\t    error_log /dev/null;\n\t\tserver_name  ssl.xgss.net;\n\t\troot /data/wwwroot/web/ssl.xgss.net/ ;\n\t\t\n\t    ssl_certificate     /data/wwwroot/web/ssl/ssl.xgss.net.key.pem;\n        ssl_certificate_key /data/wwwroot/web/ssl/ssl.xgss.net.key;\n\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_prefer_server_ciphers on;\n        ssl_dhparam /data/wwwroot/web/ssl/dhparam.pem;\n\t\t\n\t\tlocation / {\n\t\t\tindex  index.html index.htm index.php;\n\t\t}\n     }\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("浏览器访问： https://ssl.xgss.net")]),s._v(" "),e("p",[s._v("证书信息")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627161910298.png?aliyun",alt:"image-20220627161910298"}})]),s._v(" "),e("h2",{attrs:{id:"zerossl官网证书截图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zerossl官网证书截图"}},[s._v("#")]),s._v(" ZeroSSL官网证书截图")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627172051184.png?aliyun",alt:"image-20220627172051184"}})]),s._v(" "),e("h1",{attrs:{id:"dns认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dns认证"}},[s._v("#")]),s._v(" DNS认证")]),s._v(" "),e("h2",{attrs:{id:"手动dns方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#手动dns方式"}},[s._v("#")]),s._v(" 手动DNS方式")]),s._v(" "),e("p",[s._v("手动在域名上添加一条 txt 解析记录, 验证域名所有权。")]),s._v(" "),e("p",[s._v("这种方式的好处是, 你不需要任何服务器, 不需要任何公网 ip, 只需要 dns 的解析记录即可完成验证. 坏处是，如果不同时配置 Automatic DNS API，使用这种方式 acme.sh 将无法自动更新证书，每次都需要手动再次重新解析验证域名所有权。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh  --issue  --dns   -d mydomain.com \\\n --yes-I-know-dns-manual-mode-enough-go-ahead-please\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("然后, acme.sh 会生成相应的解析记录显示出来, 你只需要在你的域名管理面板中添加这条 txt 记录即可.")]),s._v(" "),e("p",[s._v("等待解析完成之后, 重新生成证书:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh  --renew   -d mydomain.com \\\n  --yes-I-know-dns-manual-mode-enough-go-ahead-please\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("注意第二次这里用的是 "),e("strong",[s._v("--renew")])]),s._v(" "),e("h2",{attrs:{id:"自动dns方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自动dns方式"}},[s._v("#")]),s._v(" 自动DNS方式")]),s._v(" "),e("p",[s._v("dns 方式的真正强大之处在于可以使用域名解析商提供的 api 自动添加 txt 记录完成验证.")]),s._v(" "),e("p",[s._v("由于"),e("code",[s._v("acme.sh")]),s._v("对域名解析/提供商的支持十分广泛,所以请针对自己所在的域名提供商获取对应的API Token，目前支持 cloudflare, dnspod, cloudxns, godaddy 以及 ovh 等数十种解析商的自动集成.")]),s._v(" "),e("p",[s._v("支持列表:"),e("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi",target:"_blank",rel:"noopener noreferrer"}},[s._v("点我跳转"),e("OutboundLink")],1),s._v(" | https://github.com/acmesh-official/acme.sh/wiki/dnsapi")]),s._v(" "),e("p",[s._v("国内目前使用较多的是某讯云和某里云，获取API Token的方法分别是：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("某讯云的"),e("code",[s._v("DNSPod")])]),s._v(" "),e("p",[s._v("登录DNSPod,进入顶部导航栏里的用户中心,在左侧的导航栏里,找到"),e("code",[s._v("安全设置")]),s._v(",看到页面的最下面,有个"),e("code",[s._v("API Token")]),s._v(".点击"),e("code",[s._v("查看")]),s._v("->"),e("code",[s._v("创建API Token")]),s._v("->填写"),e("code",[s._v("Tokens名称")]),s._v(",复制好ID与Token即可.保存待用。")])]),s._v(" "),e("li",[e("p",[s._v("某里云域名")]),s._v(" "),e("p",[s._v("需要登录到某里云官网获取Ali_Key和Ali_Secret。"),e("a",{attrs:{href:"https://usercenter.console.aliyun.com/#/manage/ak",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击此处跳转"),e("OutboundLink")],1),s._v(" | https://usercenter.console.aliyun.com/#/manage/ak")]),s._v(" "),e("p",[s._v("当然可以直接使用accessKey")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627170505702.png?aliyun",alt:"image-20220627170505702"}})]),s._v(" "),e("h2",{attrs:{id:"某里云api-token申请"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#某里云api-token申请"}},[s._v("#")]),s._v(" 某里云API Token申请")]),s._v(" "),e("p",[s._v("申请子账户来申请。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627170734108.png?aliyun",alt:"image-20220627170734108"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627170621178.png?aliyun",alt:"image-20220627170621178"}})]),s._v(" "),e("p",[s._v("详细就不列举了，有疑问可以后台提交工单。")]),s._v(" "),e("h2",{attrs:{id:"申请泛解析域名证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#申请泛解析域名证书"}},[s._v("#")]),s._v(" 申请泛解析域名证书")]),s._v(" "),e("p",[s._v("获取到对应的API Token之后我们需要将id和key设置为环境变量，供acme.sh调用：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# DNSPod\nexport DP_Id="你的 API ID"\nexport DP_Key="你的 Token"\n\n# aliyun\nexport Ali_Key="你的 AccessKey ID"\nexport Ali_Secret="你的 AccessKey Secret"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("临时环境变量只需配置这一次即可，当成功申请证书后，API 信息会被自动保存在~/.acme.sh/account.conf里，下次你使用acme.sh的时候系统会自动读取并使用。")]),s._v(" "),e("p",[s._v("腾讯云DNSpod：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --issue -d example.com -d *.example.com --dns dns_dp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("阿里云：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --issue  -d example.com -d *.example.com --dns dns_ali\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('acme.sh --issue  -d xgss.net -d *.xgss.net --dns dns_ali \\\n--keypath       /data/wwwroot/web/ssl/all.xgss.net.key  \\\n--fullchainpath /data/wwwroot/web/ssl/all.xgss.net.key.pem \\\n--reloadcmd "/usr/local/openresty/nginx/sbin/nginx -s reload"\n\nopenssl dhparam -out /data/wwwroot/web/ssl/dhparam.pem     2048      \n\n# ll /data/wwwroot/web/ssl\ntotal 16\n-rw------- 1 root root 1679 Jun 27 19:02 all.xgss.net.key\n-rw-r--r-- 1 root root 6684 Jun 27 19:02 all.xgss.net.key.pem\n-rw-r--r-- 1 root root  424 Jun 27 19:03 dhparam.pem\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627190216829.png?aliyun",alt:"image-20220627190216829"}})]),s._v(" "),e("p",[s._v("(一个小提醒, 这里用的是 service nginx force-reload, 不是 service nginx reload, 据测试, reload 并不会重新加载证书, 所以用的 force-reload)")]),s._v(" "),e("p",[e("strong",[s._v("你的KEY和Secret都将明文保存‘~/.acme.sh/account.conf’文件中，注意保护隐私。")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220628095240206.png?aliyun",alt:"image-20220628095240206"}})]),s._v(" "),e("p",[s._v("域名后台新增了两条记录")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627190154936.png?aliyun",alt:"image-20220627190154936"}})]),s._v(" "),e("h2",{attrs:{id:"验证ssl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证ssl"}},[s._v("#")]),s._v(" 验证SSL")]),s._v(" "),e("p",[s._v("浏览器打开网址，点击地址的小锁图标，可以查看更多信息。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220627190701821.png?aliyun",alt:"image-20220627190701821"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# curl https://ssl2.xgss.net/\nhello SSL\n[root@shanghai-node02 ssl]# curl https://ssl3.xgss.net/\nhello SSL\n[root@shanghai-node02 ssl]# curl https://ssl4.xgss.net/\nhello SSL\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h1",{attrs:{id:"定时更新证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定时更新证书"}},[s._v("#")]),s._v(" 定时更新证书")]),s._v(" "),e("p",[s._v("安装过程中会自动为你创建 cronjob, 每天 0:00 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("00 00 * * * root /root/.acme.sh/acme.sh --cron --home /root/.acme.sh &>/var/log/acme.sh.logs\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"查看已安装证书的信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看已安装证书的信息"}},[s._v("#")]),s._v(" 查看已安装证书的信息")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --info -d xgss.net\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"更新证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新证书"}},[s._v("#")]),s._v(" 更新证书")]),s._v(" "),e("p",[s._v("目前证书在 60 天以后会自动更新, 你无需任何操作. 今后有可能会缩短这个时间, 不过都是自动的, 你不用关心.")]),s._v(" "),e("p",[s._v("请确保 cronjob 正确安装, 看起来是类似这样的:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('crontab  -l\n\n56 * * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"更新acme-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新acme-sh"}},[s._v("#")]),s._v(" 更新acme.sh")]),s._v(" "),e("p",[s._v("目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.")]),s._v(" "),e("p",[s._v("升级 acme.sh 到最新版")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --upgrade\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果你不想手动升级, 可以开启自动升级:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh  --upgrade  --auto-upgrade\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("之后, acme.sh 就会自动保持更新了.")]),s._v(" "),e("p",[s._v("你也可以随时关闭自动更新:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("acme.sh --upgrade  --auto-upgrade  0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),e("p",[s._v("官方中文说明： https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E")])])}),[],!1,null,null,null);a.default=n.exports}}]);