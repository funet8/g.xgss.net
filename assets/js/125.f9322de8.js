(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{705:function(s,a,n){"use strict";n.r(a);var t=n(17),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"使用免费绿色工具chfs-将文件夹共享成网盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用免费绿色工具chfs-将文件夹共享成网盘"}},[s._v("#")]),s._v(" 使用免费绿色工具chfs，将文件夹共享成网盘")]),s._v(" "),n("p",[s._v("需求：")]),s._v(" "),n("p",[s._v("业务需求方有个需要将apk包上传到服务器中，通过chfs可以将服务器目录共享出来，可以可以登录后台自行上传apk文件包。")]),s._v(" "),n("p",[s._v("本文就教大家三个知识点")]),s._v(" "),n("p",[s._v("1.centos7下使用chfs，共享目录。")]),s._v(" "),n("p",[s._v("2.使用shell脚本，后台运行chfs")]),s._v(" "),n("p",[s._v("3.脚本使用脚本监控chfs是否运行，如果没有运行则重启脚本。")]),s._v(" "),n("p",[s._v("4.使用nginx反向代理（不使用IP地址）。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://imgoss.xgss.net/picgo/chfs-wangpang.jpg?aliyun",alt:"chfs-wangpang"}})]),s._v(" "),n("h2",{attrs:{id:"什么是chfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是chfs"}},[s._v("#")]),s._v(" 什么是chfs")]),s._v(" "),n("p",[s._v("官网： http://iscute.cn/chfs")]),s._v(" "),n("p",[s._v("CuteHttpFileServer/chfs是一个免费的、HTTP协议的文件共享服务器，使用浏览器可以快速访问。它具有以下特点：")]),s._v(" "),n("ul",[n("li",[s._v("单个文件，核心功能无需其他文件")]),s._v(" "),n("li",[s._v("跨平台运行，支持主流平台：Windows，Linux和Mac")]),s._v(" "),n("li",[s._v("界面简洁，简单易用")]),s._v(" "),n("li",[s._v("支持扫码下载和手机端访问，手机与电脑之间共享文件非常方便")]),s._v(" "),n("li",[s._v("支持账户权限控制和地址过滤")]),s._v(" "),n("li",[s._v("支持快速分享文字片段")]),s._v(" "),n("li",[s._v("支持webdav协议")])]),s._v(" "),n("p",[s._v("与其他常用文件共享方式（如FTP，飞秋，网盘，自己建站）相比，具有使用简单，适用场景更多的优点，在个人使用以及共享给他人的场景中非常方便快捷。")]),s._v(" "),n("h2",{attrs:{id:"一、linux下安装部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、linux下安装部署"}},[s._v("#")]),s._v(" 一、linux下安装部署")]),s._v(" "),n("h3",{attrs:{id:"系统说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#系统说明"}},[s._v("#")]),s._v(" 系统说明")]),s._v(" "),n("p",[s._v("系统：centos7\n配置：2C2G+100G\nIP：192.168.1.4\n软件： nginx1.16+php5.6")]),s._v(" "),n("h3",{attrs:{id:"下载并解压"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下载并解压"}},[s._v("#")]),s._v(" 下载并解压")]),s._v(" "),n("p",[s._v("下载对应的chfs工具：http://iscute.cn/tar/chfs/2.0/")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /data/wwwroot/web/\nmkdir chfs && cd chfs\nwget http://iscute.cn/tar/chfs/2.0/chfs-linux-amd64-2.0.zip\n备用下载：http:// js.funet8.com/centos_software/chfs-linux-amd64-2.0.zip\nunzip chfs-linux-amd64-2.0.zip\nchmod +x chfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"防火墙开启端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防火墙开启端口"}},[s._v("#")]),s._v(" 防火墙开启端口")]),s._v(" "),n("p",[s._v("根据实际端口开启9000端口，修改你自己的端口防火墙")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("iptables：\niptables -A INPUT -p tcp --dport 9000 -j ACCEPT\nservice iptables save \nsystemctl restart iptables\n\nfirewall：\nfirewall-cmd --zone=public --add-port=9000/tcp --permanent # 开放 9000 端口\nfirewall-cmd --reload                                      # 重启firewall\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"启动命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动命令"}},[s._v("#")]),s._v(" 启动命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('只允许本机访问：\n# ./chfs --port=9000 \\\n--path="/data/wwwroot/web/" \\\n--allow="127.0.0.1,192.168.1.164" \\\n--rule="::|admin:123456:rwd|user01:123456:rwd|user02:123456:r"\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"浏览器访问-ip-端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器访问-ip-端口"}},[s._v("#")]),s._v(" 浏览器访问： ip+端口")]),s._v(" "),n("p",[s._v("http://192.168.1.4:9000")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220531173109212.png?aliyun",alt:"image-20220531173109212"}})]),s._v(" "),n("p",[s._v("非192.168.1.164或者 127.0.0.1 客户端访问则是Forbidden")]),s._v(" "),n("h2",{attrs:{id:"二、使用shell脚本-后台运行chfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、使用shell脚本-后台运行chfs"}},[s._v("#")]),s._v(" 二、使用shell脚本，后台运行chfs")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# vi /data/wwwroot/web/chfs/chfs_start.sh\n填写以下：\n#!/bin/bash\n\n### 启动chfs\ncd /data/wwwroot/web/chfs/\n./chfs  --port=9000 \\\n--path="/data/wwwroot/web/apk_download/" \\\n--allow="127.0.0.1,192.168.1.164" \\\n--rule="::|admin:123456:rwd|user01:123456:rwd|user02:123456:r"\n\n### 使用：\n# chmod +x /data/wwwroot/web/chfs/chfs_start.sh\n# nohup /data/wwwroot/web/chfs/chfs_start.sh &\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"三、监控脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、监控脚本"}},[s._v("#")]),s._v(" 三、监控脚本")]),s._v(" "),n("p",[s._v("脚本使用脚本监控chfs是否运行，如果没有运行则重启脚本")]),s._v(" "),n("p",[s._v("将脚本定时任务中，每隔5分钟检测一次进程，chfs_start，如果没有检测到，则启动。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vi /data/wwwroot/web/chfs/jiankong_app.sh\n填写以下：\n\n#!/bin/bash\n\n#sh的文件名不要有grep的关键字\n###########################################################\n# vi /data/wwwroot/web/chfs/jiankong_app.sh\n# chmod +x /data/wwwroot/web/chfs/jiankong_app.sh\n# crontab 定时 \n# echo '*/5 * * * * www /data/wwwroot/web/chfs/jiankong_app.sh' >> /etc/crontab \n# systemctl restart crond\n\nLogFile=\"/data/wwwroot/web/chfs/jiankong_app.log\"\n\nprocess_pid=`ps -aux|grep -v 'grep'|grep -c 'chfs_start'`\n\n#echo \"$process_pid\"\n#关键字的个数，可以使用 grep -c\nif [ $process_pid -eq 0 ]\nthen\n\tcd /data/wwwroot/web/chfs/\n\tnohup  /data/wwwroot/web/chfs/chfs_start.sh &\n\tnow=`date  +%Y-%m-%d[%H:%M:%S]`\n\techo \"at $now restart chfs\" >> $LogFile\n\t\nfi\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h2",{attrs:{id:"四、nginx反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、nginx反向代理"}},[s._v("#")]),s._v(" 四、nginx反向代理")]),s._v(" "),n("p",[s._v("nginx的配置如下：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('upstream chfs_web {\n                keepalive      4000;\n                server  127.0.0.1:9000 max_fails=3  fail_timeout=30s;\n        }\nserver  {\n\t\tlisten          80;\n\t\tserver_name     tool-chfs.XXX.com;\n\t\taccess_log          /data/wwwroot/log/tool-chfs.XXX.com-access.log main_aliyun;\n\t\terror_log           /dev/null;\n\t\tlocation / {\t\t\n\t\t\tclient_max_body_size 1000m;\n\t\t\tproxy_pass              http://chfs_web;\n\t\t\tproxy_http_version 1.1;\n\t\t\tproxy_set_header Connection "";\n\t\t\tproxy_set_header        X-Real-IP  $remote_addr;\n\t\t\tproxy_set_header        Host             $host;\n\t\t\tproxy_set_header        X-Forwarded-For  $proxy_add_x_forwarded_for;                \n\t}\n}\n\n#nginx报错：client intended to send too large body: 29826117 bytes\n#解决方法：  client_max_body_size 1000m;\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("client_max_body_size，如果上传文件很大则，则需要修改client_max_body_size的值。")]),s._v(" "),n("h3",{attrs:{id:"官方常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官方常用命令"}},[s._v("#")]),s._v(" 官方常用命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('//都使用默认参数，共享目录为程序运行目录，监听端口号为80\nchfs\n\n//共享目录为D盘，监听端口号为8080\nchfs --path="d:/" --port=8080\n\n//共享目录为"d:\\\\projects"和"e:\\\\nsis"，监听端口号为80\nchfs --path="d:\\\\projects|e:\\\\nsis"\n\n//白名单模式，允许192.168.1.2-192.168.1.100以及192.168.1.200进行访问\nchfs --allow="192.168.1.2-192.168.1.100,192.168.1.200"\n\n//黑名单模式，禁止192.168.1.2-192.168.1.100以及192.168.1.200进行访问\nchfs --allow="not(192.168.1.2-192.168.1.100,192.168.1.200)"\n\n//匿名用户具有只读权限（默认情况下匿名用户具有读写权限）\n//账户ceshizu，密码为ceshizu123，对根目录的权限为只读，但对test目录具有读写权限\n//账户yanfazu，密码为yanfazu123，对根目录的权限为只读，但对yanfa目录具有读写权限\nchfs --rule="::r|ceshizu:ceshizu123:r:test:rw|yanfazu:yanfazu123:r:yanfa:rw"\n\n//匿名用户什么权限都没有（默认情况下匿名用户具有读写权限）\n//账户admin，密码为admin123，具有读写权限\n//账户zhangsan，密码为zhangsan123，对根目录的权限为不可读写，但对zhangsanfiles目录具有读写权限\nchfs --rule="::|admin:admin123:rw|zhangsan:zhangsan123::zhangsanfiles:rw"\n\n//通过配置文件进行配置，该文件可以不存在，待以后需要更改配置时使用\nchfs --file="d:\\chfs\\chfs.ini"\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);