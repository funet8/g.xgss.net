(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{725:function(s,e,a){"use strict";a.r(e);var r=a(17),n=Object(r.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"开源sql审核查询平台archery-基于docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开源sql审核查询平台archery-基于docker安装"}},[s._v("#")]),s._v(" 开源SQL审核查询平台Archery-基于docker安装")]),s._v(" "),a("h1",{attrs:{id:"一、archery产品介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、archery产品介绍"}},[s._v("#")]),s._v(" 一、Archery产品介绍")]),s._v(" "),a("p",[s._v("在技术团队内部进行有效的 SQL 管理并不容易，如何进行数据库的统一管理，和线上 SQL 操作的统一审核，变得尤为重要。Archery，这个开源的 SQL 审核查询平台，或许能为 SQL 审核工作带来不小的效率提升。")]),s._v(" "),a("p",[s._v("一条高质量的 SQL 语句能使整个服务加速好几倍，而一条有问题的 SQL 则可能会引发灾难，造成严重后果，因此，数据库管理人员的工作就十分重要了，他们掌握着千百万数据的命运。")]),s._v(" "),a("p",[s._v("简介")]),s._v(" "),a("p",[s._v("Archery，是 hhyo 在 Github 上开源的 SQL 审核查询平台，项目位于 https://github.com/hhyo/Archery，同时也在 Gitee 上开源，位于 https://gitee.com/rtttte/Archery")]),s._v(" "),a("h1",{attrs:{id:"二、基于docker搭建archery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、基于docker搭建archery"}},[s._v("#")]),s._v(" 二、基于docker搭建Archery")]),s._v(" "),a("h2",{attrs:{id:"_1-服务器环境介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-服务器环境介绍"}},[s._v("#")]),s._v(" 1.服务器环境介绍")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("服务器：centos7 \nIP: 192.168.1.12\n4C-8G-4T\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("本文主要参考：https://archerydms.com/installation/docker/")]),s._v(" "),a("h2",{attrs:{id:"_2-安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装docker"}},[s._v("#")]),s._v(" 2.安装docker")]),s._v(" "),a("p",[s._v("如果安装了可以跳过")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://gitee.com/funet8/centos6_LANP_dockerfile/raw/master/shell/CentOS6_7_intall_docker.sh\nsh CentOS6_7_intall_docker.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_3-安装docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装docker-compose"}},[s._v("#")]),s._v(" 3.安装docker-compose")]),s._v(" "),a("p",[s._v("如果安装了可以跳过")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sudo curl -L "https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n\n/usr/local/bin/docker-compose -v\ndocker-compose version 1.24.1, build 4667896b\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://archerydms.com/installation/docker/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker部署"),a("OutboundLink")],1),s._v("  https://archerydms.com/installation/docker/ 下载了 Archery-1.7.13 解压.")]),s._v(" "),a("p",[s._v("下载并且解压")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://github.com/hhyo/Archery/archive/v1.7.13.tar.gz\ntar -zxvf v1.7.13.tar.gz\ncd Archery-1.7.13/src/docker-compose/\nls\narchery  docker-compose.yml  inception  mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_4-安装并且docker启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装并且docker启动"}},[s._v("#")]),s._v(" 4.安装并且docker启动")]),s._v(" "),a("p",[s._v("如果有端口占用，需要修改 docker-compose.yml 里的文件端口，但是需要修改配置，宿主机最好不要占用这些端口")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 启动\ndocker-compose -f docker-compose.yml up -d\n\n生成了五个docker实例：redis inception archery goinception mysql\n \n# 表结构初始化\ndocker exec -ti archery /bin/bash\ncd /opt/archery\nsource /opt/venv4archery/bin/activate\npython3 manage.py makemigrations sql  \npython3 manage.py migrate \n\n# 数据初始化\npython3 manage.py dbshell<sql/fixtures/auth_group.sql\npython3 manage.py dbshell<src/init_sql/mysql_slow_query_review.sql\n\n# 创建管理用户\npython3 manage.py createsuperuser\n\n# python3 manage.py createsuperuser\n用户名: admin\n电子邮件地址: star@xxxxxx.com\nPassword: \nPassword (again): \nSuperuser created successfully.\n# exit\n\n# 重启\ndocker restart archery\n\n# 日志查看和问题排查\ndocker logs archery -f --tail=50\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("redis 端口：6379")]),s._v(" "),a("p",[s._v("mysql端口：3306")]),s._v(" "),a("p",[s._v("inception端口：6669")]),s._v(" "),a("p",[s._v("goinception端口：4000")]),s._v(" "),a("p",[s._v("archery端口：9123")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# docker ps\nCONTAINER ID        IMAGE                                          COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES\ne961c33a0726        redis:5                                        "docker-entrypoint..."   4 minutes ago       Up 3 minutes        6379/tcp                                                                           redis\ndec2f8e330b7        hhyo/archery:1.7.13                            "dockerize -wait t..."   4 minutes ago       Up 3 minutes        0.0.0.0:9123->9123/tcp                                                             archery\nccaca4c8d420        mysql:5.7                                      "docker-entrypoint..."   4 minutes ago       Up 3 minutes        0.0.0.0:3306->3306/tcp, 33060/tcp                                                  mysql\n5a7fc2e52484        hanchuanchuan/goinception                      "/usr/local/bin/du..."   4 minutes ago       Up 3 minutes        4000/tcp                                                                           goinception\n16ef27ac1cee        hhyo/inception                                 "/bin/sh -c \'nohup..."   4 minutes ago       Up 3 minutes        6669/tcp                                                                           inception\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h1",{attrs:{id:"三、基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、基本操作"}},[s._v("#")]),s._v(" 三、基本操作")]),s._v(" "),a("h2",{attrs:{id:"关闭docker服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭docker服务"}},[s._v("#")]),s._v(" 关闭docker服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker stop redis\ndocker stop inception\ndocker stop archery\ndocker stop goinception\ndocker stop mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"删除docker容器-谨慎操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除docker容器-谨慎操作"}},[s._v("#")]),s._v(" 删除docker容器（谨慎操作）")]),s._v(" "),a("p",[s._v("删除之后数据没有了")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker rm -f redis\ndocker rm -f inception\ndocker rm -f archery\ndocker rm -f goinception\ndocker rm -f mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问"}},[s._v("#")]),s._v(" 访问")]),s._v(" "),a("p",[s._v("访问，http://192.168.1.12:9123/  下一篇文章讲解如何配置Archery后台配置基本操作")]),s._v(" "),a("h1",{attrs:{id:"四、角色权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、角色权限"}},[s._v("#")]),s._v(" 四、角色权限")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("default\nDBA\t\t数据库管理员（Database Administrator，简称DBA）\nRD  研发（Research and Development）\nPM 项目经理( Project Manager )\nQA 测试（QUALITY ASSURANCE，中文意思是“质量保证”）\n\n工作流：\nRD--\x3eDBA--\x3eCTO（审批）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"工作流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作流"}},[s._v("#")]),s._v(" 工作流")]),s._v(" "),a("h3",{attrs:{id:"功能说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能说明"}},[s._v("#")]),s._v(" 功能说明")]),s._v(" "),a("p",[s._v("项目提供简单的多级审批流配置，审批流程和资源组以及审批类型相关，不同资源组和审批类型可以配置不同的审批流程，审批流程配置的是权限组，可避免审批人单点的问题")]),s._v(" "),a("h3",{attrs:{id:"相关配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关配置"}},[s._v("#")]),s._v(" 相关配置")]),s._v(" "),a("p",[s._v("在系统管理-配置项管理页面，可进行组工单审批流程的配置\n对于SQL上线和SQL查询权限工单，如果用户拥有('sql_review', '审核SQL上线工单')、('sql_execute_for_resource_group', '执行SQL上线工单')、('query_review', '审核查询权限')权限，就可以查看到当前用户所在资源组的所有工单\n工单待审核时，关联当前审批权限组、并且关联工单所在资源组的用户，均可查看审核工单（资源组隔离）\n待办列表包含当前用户可审核的所有工单")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20200908161641296.png?aliyun",alt:"image-20200908161641296"}})])])}),[],!1,null,null,null);e.default=n.exports}}]);