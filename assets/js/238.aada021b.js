(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{816:function(n,s,a){"use strict";a.r(s);var e=a(17),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"centos7安装openresty实现waf防火墙功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos7安装openresty实现waf防火墙功能"}},[n._v("#")]),n._v(" Centos7安装openresty实现WAF防火墙功能")]),n._v(" "),a("p",[n._v("OpenResty® 是一个结合了 Nginx 与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。\nOpenResty® 通过汇聚各种设计精良的 Nginx 模块（主要由 OpenResty 团队自主开发），从而将 Nginx 有效地变成一个强大的通用 Web 应用平台。这样，Web 开发人员和系统工程师可以使用 Lua 脚本语言调动 Nginx 支持的各种 C 以及 Lua 模块，快速构造出足以胜任 10K 乃至 1000K 以上单机并发连接的高性能 Web 应用系统。\nOpenResty® 的目标是让你的Web服务直接跑在 Nginx 服务内部，充分利用 Nginx 的非阻塞 I/O 模型，不仅仅对 HTTP 客户端请求,甚至于对远程后端诸如 MySQL、PostgreSQL、Memcached 以及 Redis 等都进行一致的高性能响应。")]),n._v(" "),a("p",[a("img",{attrs:{src:"https://imgoss.xgss.net/picgo/Centos7-openresty-16415487083161.jpg?aliyun",alt:"Centos7-openresty"}})]),n._v(" "),a("h2",{attrs:{id:"系统说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统说明"}},[n._v("#")]),n._v(" 系统说明")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("系统： centos7\nip: 192.168.1.4\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("h2",{attrs:{id:"实现waf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现waf"}},[n._v("#")]),n._v(" 实现WAF")]),n._v(" "),a("p",[n._v("两种方式")]),n._v(" "),a("p",[n._v("1.使用nginx+lua来实现WAF,须在编译nginx的时候配置上lua。")]),n._v(" "),a("p",[n._v("2.部署OpenResty,不需要在编译nginx的时候指定lua，本文采取此方案")]),n._v(" "),a("h2",{attrs:{id:"waf功能列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#waf功能列表"}},[n._v("#")]),n._v(" WAF功能列表")]),n._v(" "),a("ol",[a("li",[a("p",[n._v("支持IP白名单和黑名单功能，直接将黑名单的IP访问拒绝。")])]),n._v(" "),a("li",[a("p",[n._v("支持URL白名单，将不需要过滤的URL进行定义。")])]),n._v(" "),a("li",[a("p",[n._v("支持User-Agent的过滤，匹配自定义规则中的条目，然后进行处理（返回403）。")])]),n._v(" "),a("li",[a("p",[n._v("支持CC攻击防护，单个URL指定时间的访问次数，超过设定值，直接返回403。")])]),n._v(" "),a("li",[a("p",[n._v("支持Cookie过滤，匹配自定义规则中的条目，然后进行处理（返回403）。")])]),n._v(" "),a("li",[a("p",[n._v("支持URL过滤，匹配自定义规则中的条目，如果用户请求的URL包含这些，返回403。")])]),n._v(" "),a("li",[a("p",[n._v("支持URL参数过滤，原理同上。")])]),n._v(" "),a("li",[a("p",[n._v("支持日志记录，将所有拒绝的操作，记录到日志中去。")])]),n._v(" "),a("li",[a("p",[n._v("日志记录为JSON格式，便于日志分析，例如使用ELKStack进行攻击日志收集、存储、搜索和展示")])])]),n._v(" "),a("h1",{attrs:{id:"源码安装openresty"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码安装openresty"}},[n._v("#")]),n._v(" 源码安装openresty")]),n._v(" "),a("h2",{attrs:{id:"yum安装依赖库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yum安装依赖库"}},[n._v("#")]),n._v(" yum安装依赖库")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("yum install -y pcre-devel openssl-devel gcc postgresql-devel\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br")])]),a("h2",{attrs:{id:"下载源码包并且安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载源码包并且安装"}},[n._v("#")]),n._v(" 下载源码包并且安装")]),n._v(" "),a("p",[n._v("从下载页 "),a("a",{attrs:{href:"http://openresty.org/cn/download.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("Download"),a("OutboundLink")],1),n._v(" http://openresty.org/cn/download.html 下载最新的 OpenResty® 源码包，并且像下面的示例一样将其解压:")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("mkdir /data/software\ncd  /data/software\nwget https://openresty.org/download/openresty-1.19.9.1.tar.gz\n# 备用下载地址： http://js.funet8.com/centos_software/openresty-1.19.9.1.tar.gz\ntar -zxvf openresty-1.19.9.1.tar.gz\ncd openresty-1.19.9.1/\n\n./configure --prefix=/usr/local/openresty \\\n            --with-luajit \\\n            --without-http_redis2_module \\\n            --with-http_iconv_module \\\n            --with-http_postgres_module\n\ngmake && gmake install\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br")])]),a("p",[n._v("参考地址： http://openresty.org/cn/installation.html")]),n._v(" "),a("h2",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[n._v("#")]),n._v(" 常用命令")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("# 启动\n/usr/local/openresty/nginx/sbin/nginx\n\n# 或者指定配置文件启动\n/usr/local/openresty/nginx/sbin/nginx -c /usr/local/openresty/nginx/conf/nginx.conf -p /usr/local/openresty/nginx/\n\n浏览器访问验证是否出现： http://IP\n\n停止\n/usr/local/openresty/nginx/sbin/nginx -s stop\n\n# 启动\n/usr/local/openresty/nginx/sbin/nginx\n\n重置\n/usr/local/openresty/nginx/sbin/nginx -s reload\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br")])]),a("h2",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[n._v("#")]),n._v(" 验证")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("vim /usr/local/openresty/nginx/conf/nginx.conf\n添加：\nlocation /hello {\n                default_type 'text/plain';\n                content_by_lua 'ngx.say(\"hello,lua\")';\n        }\n \n/usr/local/openresty/nginx/sbin/nginx -s reload\n\nhttp://IP:80/hello\n\n是否输出：hello,lua\n# curl http://127.0.0.1/hello\nhello,lua\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br")])]),a("h2",{attrs:{id:"配置环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量"}},[n._v("#")]),n._v(" 配置环境变量")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("echo '# 配置OpenResty环境变量' >> /etc/profile\necho 'export OPENRESTY_HOME=/usr/local/openresty/' >> /etc/profile\necho 'export PATH=${OPENRESTY_HOME}/bin:$PATH' >> /etc/profile\necho 'PATH=/usr/local/openresty/nginx/sbin:$PATH' >> /etc/profile\necho 'export PATH' >> /etc/profile\n\n生效：\nsource  /etc/profile\n\necho $OPENRESTY_HOME\n\nopenresty -s reload\nnginx -V\nnginx -t\n\n# openresty -help\nnginx version: openresty/1.19.9.1\nUsage: nginx [-?hvVtTq] [-s signal] [-p prefix]\n             [-e filename] [-c filename] [-g directives]\n\nOptions:\n  -?,-h         : this help\n  -v            : show version and exit\n  -V            : show version and configure options then exit\n  -t            : test configuration and exit\n  -T            : test configuration, dump it and exit\n  -q            : suppress non-error messages during configuration testing\n  -s signal     : send signal to a master process: stop, quit, reopen, reload\n  -p prefix     : set prefix path (default: /usr/local/openresty/nginx/)\n  -e filename   : set error log file (default: logs/error.log)\n  -c filename   : set configuration file (default: conf/nginx.conf)\n  -g directives : set global directives out of configuration file\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br")])]),a("h1",{attrs:{id:"安装并且配置waf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装并且配置waf"}},[n._v("#")]),n._v(" 安装并且配置WAF")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('# git clone https://github.com/unixhot/waf.git\n\n克隆到自己的仓库：\n# git clone https://gitee.com/funet8/waf.git\n\n# cd /usr/local/openresty/nginx/conf/\n# git clone https://gitee.com/funet8/waf.git waf-git\n# cp -a ./waf-git/waf /usr/local/openresty/nginx/conf/\n\n# vim /usr/local/openresty/nginx/conf/nginx.conf\n\n#在http{}中增加，注意路径，同时WAF日志默认存放在/tmp/日期_waf.log\n#WAF\n    lua_shared_dict limit 50m;\n    lua_package_path "/usr/local/openresty/nginx/conf/waf/?.lua";\n    init_by_lua_file "/usr/local/openresty/nginx/conf/waf/init.lua";\n    access_by_lua_file "/usr/local/openresty/nginx/conf/waf/access.lua";\n\nwaf目录：/usr/local/openresty/nginx/conf/waf/\nlua配置文件：/usr/local/openresty/nginx/conf/waf/config.lua\nWaf的ip黑名单：/usr/local/openresty/nginx/conf/waf/rule-config/blackip.rule\nWaf的ip白名单：/usr/local/openresty/nginx/conf/waf/rule-config/whiteip.rule\nWaf的规则存放目录：/usr/local/openresty/nginx/conf/waf/rule-config\n\n    \n# ln -s /usr/local/openresty/lualib/resty/ /usr/local/openresty/nginx/conf/waf/resty\n# /usr/local/openresty/nginx/sbin/nginx -t\n# /usr/local/openresty/nginx/sbin/nginx -s reload\n\n然后保存退出重启看日志\nopenresty -t && openresty -s reload\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br")])]),a("h1",{attrs:{id:"waf模块配置文件详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#waf模块配置文件详解"}},[n._v("#")]),n._v(" WAF模块配置文件详解")]),n._v(" "),a("p",[n._v("来学习一下waf/config.lua配置文件中的内容")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("cat /usr/local/openresty/nginx/conf/waf/config.lua\n--lua文件中，--为行注释，\n--[[\n这是块注释\n--]]\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('cat /usr/local/openresty/nginx/conf/waf/config.lua\n\nconfig_waf_enable = "on" --是否启用waf模块，值为 on 或 off\nconfig_log_dir = "/tmp" --waf的日志位置，日志格式默认为json\nconfig_rule_dir = "/usr/local/openresty/nginx/conf/waf/rule-config" --策略规则目录位置，可根据情况变动\nconfig_white_url_check = "on" --是否开启URL检测\nconfig_white_ip_check = "on" --是否开启IP白名单检测\nconfig_black_ip_check = "on" --是否开启IP黑名单检测\nconfig_url_check = "on" --是否开启URL过滤\nconfig_url_args_check = "on" --是否开启Get参数过滤\nconfig_user_agent_check = "on" --是否开启UserAgent客户端过滤\nconfig_cookie_check = "on" --是否开启cookie过滤\nconfig_cc_check = "on" --是否开启cc攻击过滤\nconfig_cc_rate = "10/60" --cc攻击的速率/时间，单位为秒；默认示例中为单个IP地址在60秒内访问同一个页面次数超过10次则认为是cc攻击，则自动禁止此IP地址访问此页面60秒，60秒后解封(封禁过程中此IP地址依然可以访问其它页面，如果同一个页面访问次数超过10次依然会被禁止)\nconfig_post_check = "on" --是否开启POST检测\nconfig_waf_output = "html" --对于违反规则的请求则跳转到一个自定义html页面还是指定页面，值为 html 和 redirect\nconfig_waf_redirect_url = "https://www.unixhot.com" --指定违反请求后跳转的指定html页面\n--指定违反规则后跳转的自定义html页面\nconfig_output_html=[[\n<html>\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta http-equiv="Content-Language" content="zh-cn" />\n<title>网站防火墙</title>\n</head>\n<body>\n<h1 align="center"> 欢迎白帽子进行授权安全测试，安全漏洞请联系QQ：1111111。\n</body>\n</html>\n]]\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br")])]),a("h2",{attrs:{id:"ip黑名单配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ip黑名单配置"}},[n._v("#")]),n._v(" IP黑名单配置")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_black_ip_check = "on"参数\nIP黑名单配置非常简单，这个与Nginx的ngx_http_access_module模块原理是一致的，只需要把拒绝的地址加入到 waf/rule-config/blackip.rule文件中即可')]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("cat /usr/local/openresty/nginx/conf/waf/rule-config/blackip.rule\n192.168.1.4\n然后访问Openresty地址，如下已返回403被禁止\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br")])]),a("h2",{attrs:{id:"ip白名单配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ip白名单配置"}},[n._v("#")]),n._v(" IP白名单配置")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_white_ip_check = "on"参数\nIP白名单与黑名单相冲突，添加到IP白名单中的IP不受WAF限制,具体请自行测试')]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("cat /usr/local/openresty/nginx/conf/waf/rule-config/whiteip.rule\n192.168.1.4\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("h2",{attrs:{id:"cc攻击过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cc攻击过滤"}},[n._v("#")]),n._v(" CC攻击过滤")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_cc_check = "on"参数，然后指定config_cc_rate = "10/60"速率和时间\nCC攻击只需要在config.lua配置文件中指定上面的两个参数即可')]),n._v(" "),a("p",[n._v("如下指定在60秒内对于单个IP地址访问单个页面的次数最大10次，超过10次则自动拉入黑名单，60秒后自动解除")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('vim /usr/local/openresty/nginx/conf/waf/config.lua\nconfig_cc_check = "on"\nconfig_cc_rate = "10/60"\n然后进行测试,如下刷新10次以后就变为来403\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("p",[n._v("我们换个页面再次刷新，如下换个页面可以正常访问，不过连续对一个页面60秒内刷新10次以后将也被拉入黑名单")]),n._v(" "),a("h2",{attrs:{id:"异常url策略配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常url策略配置"}},[n._v("#")]),n._v(" 异常URL策略配置")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_url_check = "on"参数\n然后定义rule-config/url.rule文件，url.rule文件默认为如下，如果匹配到规则的将跳转到由config.lua中config_waf_output = "html"参数指定的页面')]),n._v(" "),a("p",[n._v("禁止URL访问 .htaccess|.bash_history 的文件\n禁止URL访问包含带有phpmyadmin|jmx-console|admin-console|jmxinvokerservlet地址\n禁止URL访问包含 java.lang 的地址\n禁止URL访问包含 .svn/ 的地址")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("cat url.rule\n\\.(htaccess|bash_history)\n\\.(bak|inc|old|mdb|sql|backup|java|class|tgz|gz|tar|zip)$\n(phpmyadmin|jmx-console|admin-console|jmxinvokerservlet)\njava\\.lang\n\\.svn\\/\n/(attachments|upimg|images|css|uploadfiles|html|uploads|templets|static|template|data|inc|forumdata|upload|includes|cache|avatar)/(\\\\w+).(php|jsp)\n假如你不想让别人访问根下的/login，那么就可以写入到配置中\n\ncat url.rule\n\\.(htaccess|bash_history)\n\\.(bak|inc|old|mdb|sql|backup|java|class|tgz|gz|tar|zip)$\n(phpmyadmin|jmx-console|admin-console|jmxinvokerservlet)\njava\\.lang\n\\.svn\\/\n/(attachments|upimg|images|css|uploadfiles|html|uploads|templets|static|template|data|inc|forumdata|upload|includes|cache|avatar)/(\\\\w+).(php|jsp)\n/login\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br")])]),a("p",[n._v("然后进行重启后访问,如下就跳转到了我们在config.lua中指定的页面，此页面可根据需求进行修改。如果上面默认的url规则匹配到了你的地址，那么你就可以把相应配置去掉")]),n._v(" "),a("h2",{attrs:{id:"异常useragent策略配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常useragent策略配置"}},[n._v("#")]),n._v(" 异常UserAgent策略配置")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_user_agent_check = "on"参数')]),n._v(" "),a("p",[n._v("WAF模块中默认封锁了以下UserAgent，如\nHTTrack网站下载\nnamp网络扫描\naudit网络审计\ndirbuster网站目录扫描\npangolin SQL注入工具\nscan网络扫描\nhydra密码暴力破解\nlibwww漏洞工具\nsqlmap自动SQL注入工具\nw3af网络扫描\nNikto Web漏洞扫描\n…\n等等")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('cat useragent.rule\n(HTTrack|harvest|audit|dirbuster|pangolin|nmap|sqln|-scan|hydra|Parser|libwww|BBBike|sqlmap|w3af|owasp|Nikto|fimap|havij|PycURL|zmeu|BabyKrokodil|netsparker|httperf|bench)\n我们正常访问URL是没问题的，下面来模拟一个非法的UserAgent进行访问\n\n#模拟网站下载\ncurl http://192.168.31.219/ --user-agent \'HTTrack\'\n<html>\n\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta http-equiv="Content-Language" content="zh-cn" />\n<title>网站防火墙</title>\n</head>\n\n<body>\n\n<h1 align="center"> 欢迎白帽子进行授权安全测试，安全漏洞请联系QQ：1111111。\n</body>\n</html>\n#模拟nmap网络扫描\ncurl http://192.168.31.219/ --user-agent \'nmap\'\n<html>\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta http-equiv="Content-Language" content="zh-cn" />\n<title>网站防火墙</title>\n</head>\n<body>\n<h1 align="center"> 欢迎白帽子进行授权安全测试，安全漏洞请联系QQ：1111111。\n</body>\n</html>\n添加禁止Chrome浏览器访问的UserAgent\n\n#跟随配置添加到最后\ncat useragent.rule\n(HTTrack|harvest|audit|dirbuster|pangolin|nmap|sqln|-scan|hydra|Parser|libwww|BBBike|sqlmap|w3af|owasp|Nikto|fimap|havij|PycURL|zmeu|BabyKrokodil|netsparker|httperf|bench|Chrome)\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br")])]),a("p",[n._v("然后重启Openrestry，通过Chrome浏览器进行访问，命中了WAF的规则")]),n._v(" "),a("h2",{attrs:{id:"异常get参数策略配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常get参数策略配置"}},[n._v("#")]),n._v(" 异常Get参数策略配置")]),n._v(" "),a("p",[n._v('需要在config.lua配置中开启config_url_args_check = "on"参数')]),n._v(" "),a("p",[n._v("默认封锁了如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("cat args.rule\n\\.\\./\n\\:\\$\n\\$\\{\nselect.+(from|limit)\n(?:(union(.*?)select))\nhaving|rongjitest\nsleep\\((\\s*)(\\d*)(\\s*)\\)\nbenchmark\\((.*)\\,(.*)\\)\nbase64_decode\\(\n(?:from\\W+information_schema\\W)\n(?:(?:current_)user|database|schema|connection_id)\\s*\\(\n(?:etc\\/\\W*passwd)\ninto(\\s+)+(?:dump|out)file\\s*\ngroup\\s+by.+\\(\nxwork.MethodAccessor\n(?:define|eval|file_get_contents|include|require|require_once|shell_exec|phpinfo|system|passthru|preg_\\w+|execute|echo|print|print_r|var_dump|(fp)open|alert|showmodaldialog)\\(\nxwork\\.MethodAccessor\n(gopher|doc|php|glob|file|phar|zlib|ftp|ldap|dict|ogg|data)\\:\\/\njava\\.lang\n\\$_(GET|post|cookie|files|session|env|phplib|GLOBALS|SERVER)\\[\n\\<(iframe|script|body|img|layer|div|meta|style|base|object|input)\n(onmouseover|onerror|onload)\\=\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br")])]),a("p",[n._v("验证")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('我们进行访问 http://192.168.31.219/hello?aa=select id from mysql,得到如下，进行匹配\n\ncurl \'http://192.168.31.219/hello?aa=select id from mysql\'\n<html>\n\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta http-equiv="Content-Language" content="zh-cn" />\n<title>网站防火墙</title>\n</head>\n\n<body>\n\n<h1 align="center"> 欢迎白帽子进行授权安全测试，安全漏洞请联系QQ：1111111。\n</body>\n</html>\n我们也可以根据自己需求去配置，如下最后添加abcops\n\ncat args.rule\n\\.\\./\n\\:\\$\n\\$\\{\nselect.+(from|limit)\n(?:(union(.*?)select))\nhaving|rongjitest\nsleep\\((\\s*)(\\d*)(\\s*)\\)\nbenchmark\\((.*)\\,(.*)\\)\nbase64_decode\\(\n(?:from\\W+information_schema\\W)\n(?:(?:current_)user|database|schema|connection_id)\\s*\\(\n(?:etc\\/\\W*passwd)\ninto(\\s+)+(?:dump|out)file\\s*\ngroup\\s+by.+\\(\nxwork.MethodAccessor\n(?:define|eval|file_get_contents|include|require|require_once|shell_exec|phpinfo|system|passthru|preg_\\w+|execute|echo|print|print_r|var_dump|(fp)open|alert|showmodaldialog)\\(\nxwork\\.MethodAccessor\n(gopher|doc|php|glob|file|phar|zlib|ftp|ldap|dict|ogg|data)\\:\\/\njava\\.lang\n\\$_(GET|post|cookie|files|session|env|phplib|GLOBALS|SERVER)\\[\n\\<(iframe|script|body|img|layer|div|meta|style|base|object|input)\n(onmouseover|onerror|onload)\\=\nabcops\n然后我们进行访问http://192.168.31.219/hello?aa=abcops也会匹配到规则\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br")])]),a("h2",{attrs:{id:"异常post参数策略配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常post参数策略配置"}},[n._v("#")]),n._v(" 异常POST参数策略配置")]),n._v(" "),a("p",[n._v('需要在config.lua中开启config_post_check = "on"选项，默认POST请求封禁如下，POST封禁内容与GET相似')]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('cat post.rule\n\\.\\./\nselect.+(from|limit)\n(?:(union(.*?)select))\nhaving|rongjitest\nsleep\\((\\s*)(\\d*)(\\s*)\\)\nbenchmark\\((.*)\\,(.*)\\)\nbase64_decode\\(\n(?:from\\W+information_schema\\W)\n(?:(?:current_)user|database|schema|connection_id)\\s*\\(\n(?:etc\\/\\W*passwd)\ninto(\\s+)+(?:dump|out)file\\s*\ngroup\\s+by.+\\(\nxwork.MethodAccessor\n(?:define|eval|file_get_contents|include|require|require_once|shell_exec|phpinfo|system|passthru|preg_\\w+|execute|echo|print|print_r|var_dump|(fp)open|alert|showmodaldialog)\\(\nxwork\\.MethodAccessor\n(gopher|doc|php|glob|file|phar|zlib|ftp|ldap|dict|ogg|data)\\:\\/\njava\\.lang\n\\$_(GET|post|cookie|files|session|env|phplib|GLOBALS|SERVER)\\[\n\\<(iframe|script|body|img|layer|div|meta|style|base|object|input)\n(onmouseover|onerror|onload)\\=\n直接对POST策略进行提交请求，通过curl -XPOST来进行提交POST请求\n\ncurl -XPOST \'http://192.168.31.219/hello?aa=select id from mysql\'\n<html>\n\n<head>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta http-equiv="Content-Language" content="zh-cn" />\n<title>网站防火墙</title>\n</head>\n\n<body>\n\n<h1 align="center"> 欢迎白帽子进行授权安全测试，安全漏洞请联系QQ：1111111。\n</body>\n</html>\n如上命中规则，我们查看Openrestry日志，查看是否为POST请求\n\ntail -1 /usr/local/openresty/nginx/logs/access.log\n192.168.31.217 - - [27/Jul/2020:18:21:32 +0800] "POST /hello?aa=select id from mysql HTTP/1.1" 403 313 "-" "curl/7.29.0"\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);