(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{642:function(s,e,r){"use strict";r.r(e);var t=r(17),a=Object(t.a)({},(function(){var s=this,e=s.$createElement,r=s._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"docker优化硬盘空间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker优化硬盘空间"}},[s._v("#")]),s._v(" docker优化硬盘空间")]),s._v(" "),r("h2",{attrs:{id:"_1-docker-system命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-system命令"}},[s._v("#")]),s._v(" 1. docker system命令")]),s._v(" "),r("p",[s._v("docker system df命令，类似于Linux上的df命令，用于查看Docker的磁盘使用情况:")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker system df\nTYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE\nImages              147                 36                  7.204GB             3.887GB (53%)\nContainers          37                  10                  104.8MB             102.6MB (97%)\nLocal Volumes       3                   3                   1.421GB             0B (0%)\nBuild Cache                                                 0B                  0B\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("p",[s._v("可知，Docker镜像占用了"),r("strong",[s._v("7.2GB")]),s._v("磁盘，Docker容器占用了"),r("strong",[s._v("104.8MB")]),s._v("磁盘，Docker数据卷占用了"),r("strong",[s._v("1.4GB")]),s._v("磁盘。")]),s._v(" "),r("h2",{attrs:{id:"docker-system-prune命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-system-prune命令"}},[s._v("#")]),s._v(" docker system prune命令")]),s._v(" "),r("p",[r("strong",[s._v("docker system prune")]),s._v("命令可以用于清理磁盘，删除关闭的容器、无用的数据卷和网络，以及dangling镜像(即无tag的镜像)。\n"),r("strong",[s._v("docker system prune -a")]),s._v("命令清理得更加彻底，可以将没有容器使用Docker镜像都删掉。注意，这两个命令会把你暂时关闭的容器，以及暂时没有用到的Docker镜像都删掉了…所以使用之前一定要想清楚吶。")]),s._v(" "),r("h2",{attrs:{id:"_2-手动清理docker镜像-容器-数据卷"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-手动清理docker镜像-容器-数据卷"}},[s._v("#")]),s._v(" 2. 手动清理Docker镜像/容器/数据卷")]),s._v(" "),r("p",[s._v("对于旧版的Docker(版本1.13之前)，是没有docker system命令的，因此需要进行手动清理。这里给出几个常用的命令\n"),r("strong",[s._v("删除所有关闭的容器")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker ps -a | grep Exit | cut -d '' -f 1 | xargs docker rm\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("strong",[s._v("删除所有dangling镜像(即无tag的镜像)：")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('docker rmi $(docker images | grep "^<none>" | awk "{print $3}")\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("strong",[s._v("删除所有dangling数据卷(即无用的volume)：")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker volume rm $(docker volume ls -qf dangling=true)\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("在内网测试机上，跑的三个docker虚拟机里面安装mysql之后，硬盘空间被占满\n删除所有的镜像，依然无法腾出硬盘空间")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("生产环境谨慎使用！\nsystemctl stop docker\nrm -rf /var/lib/docker/*\nsystemctl start docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("https://www.cnblogs.com/fundebug/p/8353158.html\nhttps://segmentfault.com/q/1010000005846603/a-1020000005854058")])])}),[],!1,null,null,null);e.default=a.exports}}]);