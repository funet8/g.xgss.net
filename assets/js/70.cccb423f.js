(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{650:function(a,s,t){"use strict";t.r(s);var n=t(17),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"再见github和码云-基于linux安装私有化部署gitlab代码仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#再见github和码云-基于linux安装私有化部署gitlab代码仓库"}},[a._v("#")]),a._v(" 再见Github和码云！基于Linux安装私有化部署GitLab代码仓库")]),a._v(" "),t("p",[a._v("最近访问自己的Gitee开源仓库时候，需要手动提交审核，并且同意gitee.com的条款，好在审核1-2小时就审核通过了，但还是有些膈应。Github也是经常性抽风，不如就自己搭建gitlab的仓库，没有条条框框的限制。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520161426092.png?aliyun",alt:"image-20220520161426092"}})]),a._v(" "),t("p",[a._v("同意条款：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520161822355.png?aliyun",alt:"image-20220520161822355"}})]),a._v(" "),t("h2",{attrs:{id:"什么是gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是gitlab"}},[a._v("#")]),a._v(" 什么是Gitlab")]),a._v(" "),t("p",[a._v("GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的Web服务，可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/gitlabcangku.jpg?aliyun",alt:"gitlabcangku"}})]),a._v(" "),t("h2",{attrs:{id:"前期准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[a._v("#")]),a._v(" 前期准备")]),a._v(" "),t("p",[a._v("一台Linux服务器，vm虚拟机或者云服务器均可，"),t("strong",[a._v("内存要大于1G")]),a._v("（别问，问就是：Whoops, GitLab is taking too much time to respond.），硬盘大于20G。")]),a._v(" "),t("p",[a._v("本次使用centos7")]),a._v(" "),t("p",[a._v("可选： 域名一个，SSL证书。")]),a._v(" "),t("h1",{attrs:{id:"安装gitlab的三种方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab的三种方法"}},[a._v("#")]),a._v(" 安装Gitlab的三种方法")]),a._v(" "),t("p",[a._v("1.官方Linux安装包")]),a._v(" "),t("p",[a._v("2.docker安装")]),a._v(" "),t("p",[a._v("3.下载想要的rpm包安装")]),a._v(" "),t("p",[a._v("相对于三种方法，个人更加推荐使用docker。")]),a._v(" "),t("h2",{attrs:{id:"一、官方linux安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、官方linux安装包"}},[a._v("#")]),a._v(" 一、官方Linux安装包")]),a._v(" "),t("h2",{attrs:{id:"_1-安装和配置必须的依赖项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装和配置必须的依赖项"}},[a._v("#")]),a._v(" 1. 安装和配置必须的依赖项")]),a._v(" "),t("p",[a._v("在 CentOS 7上，下面的命令也会在系统防火墙中打开 HTTP、HTTPS 和 SSH 访问。这是一个可选步骤，如果您打算仅从本地网络访问GitLab，则可以跳过它。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("sudo yum install -y curl policycoreutils-python openssh-server perl\nsudo systemctl enable sshd\nsudo systemctl start sshd\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo systemctl reload firewalld\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("h2",{attrs:{id:"_2-下载-安装极狐gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-下载-安装极狐gitlab"}},[a._v("#")]),a._v(" 2. 下载/安装极狐GitLab")]),a._v(" "),t("p",[a._v("配置GitLab 软件源镜像。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -fsSL https://packages.gitlab.cn/repository/raw/scripts/setup.sh | /bin/bash\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("执行如下命令开始安装：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('EXTERNAL_URL="https://gitlab.example.com" yum install -y gitlab-jh\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("h2",{attrs:{id:"_3-访问极狐gitlab-实例并登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问极狐gitlab-实例并登录"}},[a._v("#")]),a._v(" 3. 访问极狐GitLab 实例并登录")]),a._v(" "),t("p",[a._v("除非您在安装过程中指定了自定义密码，否则将随机生成一个密码并存储在 /etc/gitlab/initial_root_password 文件中(出于安全原因，24 小时后，此文件会被第一次 "),t("code",[a._v("gitlab-ctl reconfigure")]),a._v(" 自动删除，因此若使用随机密码登录，建议安装成功初始登录成功之后，立即修改初始密码）。使用此密码和用户名 "),t("code",[a._v("root")]),a._v(" 登录。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(" cat /etc/gitlab/initial_root_password\n Password: qZiiPJmRgReOLaBbB9FQ8ZJULnu2nqxwBjHnzozvCwI=\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("登录gitlab页面即可")]),a._v(" "),t("h1",{attrs:{id:"二、基于docker安装gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、基于docker安装gitlab"}},[a._v("#")]),a._v(" 二、基于docker安装Gitlab")]),a._v(" "),t("h2",{attrs:{id:"_1-安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装docker"}},[a._v("#")]),a._v(" 1.安装docker")]),a._v(" "),t("p",[a._v("略")]),a._v(" "),t("h2",{attrs:{id:"_2-运行docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-运行docker"}},[a._v("#")]),a._v(" 2.运行docker")]),a._v(" "),t("p",[a._v("官方文档：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("export GITLAB_HOME=/srv/gitlab\nsudo docker run --detach \\\n  --hostname gitlab.example.com \\\n  --publish 443:443 --publish 80:80 --publish 22:22 \\\n  --name gitlab \\\n  --restart always \\\n  --volume $GITLAB_HOME/config:/etc/gitlab \\\n  --volume $GITLAB_HOME/logs:/var/log/gitlab \\\n  --volume $GITLAB_HOME/data:/var/opt/gitlab \\\n  --shm-size 256m \\\n  registry.gitlab.cn/omnibus/gitlab-jh:latest\n  \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br")])]),t("p",[a._v("由于服务器的443、80端口被占用，所有这里改成")]),a._v(" "),t("p",[a._v("文件目录： /data/docker/gitlab/")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker run -itd \\\n--hostname gitlab.xgss.net \\\n-p 444:443 -p 81:80 --name gitlab \\\n--restart always \\\n-v /data/docker/gitlab/config:/etc/gitlab \\\n-v /data/docker/gitlab/logs:/var/log/gitlab \\\n-v /data/docker/gitlab/data:/var/opt/gitlab \\\n-v /etc/localtime:/etc/localtime \\\ngitlab/gitlab-ce:latest\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("解释")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("\n# gitlab.xgss.net  解析到服务器ip\n访问： http://gitlab.xgss.net:81/\n或者通过服务器的nginx再代理转发过去，就不用加端口了。\n\nserver {\n        listen       80;\n        server_name  gitlab.xgss.net;\n        access_log /data/wwwroot/log/gitlab.xgss.net-access.log main_aliyun;\n        error_log /dev/null;\n        location / {\n                proxy_pass      http://127.0.0.1:81;\n                proxy_redirect off;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n}\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520164950184.png?aliyun",alt:"image-20220520164950184"}})]),a._v(" "),t("p",[a._v("查看密码")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cat /data/docker/gitlab/config/initial_root_password \nPassword: fSXXjErvK*****\n\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("重置密码：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520165701988.png?aliyun",alt:"image-20220520165701988"}})]),a._v(" "),t("p",[a._v("由于我安装的是gitlab的英文版，可以汉化。也可以直接安装docker gitlab中文版的镜像")]),a._v(" "),t("h2",{attrs:{id:"汉化版的gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#汉化版的gitlab"}},[a._v("#")]),a._v(" 汉化版的gitlab")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker pull twang2218/gitlab-ce-zh:latest\n启动\n\ndocker run -itd \\\n--hostname gitlab.xgss.net \\\n-p 444:443 -p 81:80 --name gitlab \\\n--restart always \\\n-v /data/docker/gitlab/config:/etc/gitlab \\\n-v /data/docker/gitlab/logs:/var/log/gitlab \\\n-v /data/docker/gitlab/data:/var/opt/gitlab \\\n-v /etc/localtime:/etc/localtime \\\ntwang2218/gitlab-ce-zh:latest\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520171358994.png?aliyun",alt:"image-20220520171358994"}})]),a._v(" "),t("h1",{attrs:{id:"三、下载rpm包安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、下载rpm包安装"}},[a._v("#")]),a._v(" 三、下载rpm包安装")]),a._v(" "),t("h2",{attrs:{id:"_1-下载rpm包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载rpm包"}},[a._v("#")]),a._v(" 1.下载rpm包")]),a._v(" "),t("p",[a._v("gitlab包RPM官方下载：https://packages.gitlab.com/gitlab/gitlab-ce ，你可以选择任意想要的版本下载。")]),a._v(" "),t("p",[a._v("我选择gitlab-ce-8.2.2-ce.0.el6.x86_64.rpm，这个版本比较老，建议下载最新的，")]),a._v(" "),t("p",[a._v("把下载的文件放到百度网盘：")]),a._v(" "),t("p",[a._v("链接：https://pan.baidu.com/s/1-N_BAKRzz4lm8blu25Oz7w  提取码：0pwc")]),a._v(" "),t("h2",{attrs:{id:"_2-通过rpm安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过rpm安装"}},[a._v("#")]),a._v(" 2.通过rpm安装")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("#  yum install -y curl openssh-server postftix cronie wget\n#  yum install -y postfix\n# systemctl enable postfix\n# systemctl start postfix\n#  lokkit -s http -s ssh\n#  wget https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh\n#  sh script.rpm.sh \n\n# rz 【上传gitlab-ce-8.2.2-ce.0.el6.x86_64.rpm】\n# yum install -y gitlab-ce-8.2.2-ce.0.el6.x86_64.rpm \n# gitlab-ctl reconfigure\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("h2",{attrs:{id:"_3-访问gitlab"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问gitlab"}},[a._v("#")]),a._v(" 3.访问gitlab")]),a._v(" "),t("p",[a._v("访问：\nhttp://192.168.1.243/")]),a._v(" "),t("p",[a._v("初始密码：\nUsername: root\nPassword: 5iveL!fe")]),a._v(" "),t("p",[a._v("修改初始密码。")]),a._v(" "),t("p",[a._v("就可以使用gitlab的后台创建项目和用户。")]),a._v(" "),t("p",[a._v("运行多年之后的截图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220520162449484.png?aliyun",alt:"image-20220520162449484"}})]),a._v(" "),t("h3",{attrs:{id:"修改配置ip或者域名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置ip或者域名"}},[a._v("#")]),a._v(" 修改配置IP或者域名")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("vi /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml\n\n gitlab:\n   ## Web server settings\n   host: 192.168.1.243   # 这里也可以改成域名\n   port: 80\n   https: false\n重启服务,就可以了    \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("更改配置后，执行如下命令（加载配置生效）：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("sudo gitlab-ctl reconfigure\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("服务打开、关闭、重启：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("gitlab-ctl start\ngitlab-ctl stop\ngitlab-ctl restart\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("h1",{attrs:{id:"四、gitlab的备份与恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、gitlab的备份与恢复"}},[a._v("#")]),a._v(" 四、Gitlab的备份与恢复")]),a._v(" "),t("p",[a._v("如果使用docker安装则直接备份gitlab目录即可。")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("gitlab-ctl start\n\ngitlab所有的工程目录：\n/var/opt/gitlab/\n仓库文件\n/var/opt/gitlab/git-data/repositories\n默认备份目录，修改此目录：\n/var/opt/gitlab/backups\t\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("新建gitlab的备份目录")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# mkdir /home/git_bak\t\n# chown git:root -R /home/git_bak/\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("修改配置文件")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('vi /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml\n\n  backup:\n    path: "/var/opt/gitlab/backups" \n改为：\n  backup:\n    path: "/home/git_bak"\n\n有的版本/etc/gitlab/gitlab.rb\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("重启服务")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# gitlab-ctl restart\t\t【重启】\n# /opt/gitlab/bin/gitlab-rake gitlab:backup:create\t【备份git】\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h2",{attrs:{id:"恢复gitlab备份方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恢复gitlab备份方法"}},[a._v("#")]),a._v(" 恢复Gitlab备份方法")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# gitlab-ctl stop unicorn\n# gitlab-ctl stop sidekiq\n\n# gitlab-rake gitlab:backup:restore BACKUP=1459415571\t【恢复备份】\nUnpacking backup ... \n[root@localhost backups]# gitlab-ctl start\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("h2",{attrs:{id:"gitlab定时自动备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gitlab定时自动备份"}},[a._v("#")]),a._v(" gitlab定时自动备份")]),a._v(" "),t("p",[a._v("添加定时脚本：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('# vi /etc/crontab\n添加以下：\n#周六凌晨2点备份gitlab文件\n0 2 * * 1 root /home/git_bak/gitbak.sh  >> /home/git_bak/gitbak.log\n\ncat /home/git_bak/gitbak.sh\n#备份GIT################################################################\n/opt/gitlab/bin/gitlab-rake gitlab:backup:create\nsleep 30\n\n################自动删除7天前gitlab备份文件#########################\nndays="7"\nwheredir="/home/git_bak/*"\nfind $wheredir -mtime +$ndays -name "*_gitlab_backup.tar" -exec rm -rf {} \\;\nsleep 30\n\n#备份文件推送到内网其他服务器中。\n#/usr/bin/rsync -ahqzt -e "ssh -p 22"  --delete /home/git_bak/    root@192.168.1.10:/data/backup/192.168.1.9/gitlab_bak/\n\n#  systemctl restart crond\n')])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br")])]),t("p",[a._v("查看备份目录：")]),a._v(" "),t("p",[a._v("双保险：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ll -h /home/git_bak/\ntotal 49G\n-rw------- 1 git  git   24G May  9 03:31 1652036724_gitlab_backup.tar\n-rw------- 1 git  git   25G May 16 03:38 1652641989_gitlab_backup.tar\n-rw-r--r-- 1 root root 1.9M May 16 03:38 gitbak.log\n-rwxr-xr-x 1 root root 2.1K Sep  5  2020 gitbak.sh\n\n备份服务器中的文件：\n# ll -h /data/backup/192.168.1.9/gitlab_bak/\ntotal 49G\n-rw------- 1 nginx dockerroot  24G May  9 03:31 1652036724_gitlab_backup.tar\n-rw------- 1 nginx dockerroot  25G May 16 03:38 1652641989_gitlab_backup.tar\n-rw-r--r-- 1 root  root       1.9M May 16 03:38 gitbak.log\n-rwxr-xr-x 1 root  root       2.1K Sep  5  2020 gitbak.sh\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("参考文件")]),a._v(" "),t("p",[a._v("官方Linux安装包： https://about.gitlab.cn/install/")]),a._v(" "),t("p",[a._v("官方GitLab Docker 镜像： https://docs.gitlab.cn/jh/install/docker.html")])])}),[],!1,null,null,null);s.default=e.exports}}]);