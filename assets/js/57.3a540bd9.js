(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{636:function(s,a,e){"use strict";e.r(a);var r=e(17),t=Object(r.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker系列教程4-使用docker-hub并将镜像推送到自有仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker系列教程4-使用docker-hub并将镜像推送到自有仓库"}},[s._v("#")]),s._v(" Docker系列教程4：使用Docker Hub并将镜像推送到自有仓库")]),s._v(" "),e("h1",{attrs:{id:"dockerhub是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dockerhub是什么"}},[s._v("#")]),s._v(" DockerHub是什么")]),s._v(" "),e("p",[s._v("目前 Docker 官方维护了一个公共仓库 Docker Hub，其中已经包括了数量超过 2,650,000 的镜像。大部分需求都可以通过在 Docker Hub 中直接下载镜像来实现。")]),s._v(" "),e("p",[s._v("我更愿意把他类比 github，docker是存放镜像，github是存放代码的。")]),s._v(" "),e("p",[s._v("这样自己制作的镜像就可以把它推送（docker push）到DockerHub，要使用的时候直接拉取（docker pull），让开发更加灵活。")]),s._v(" "),e("p",[s._v("本次教程主要有三部分就教"),e("strong",[s._v("1.如何使用DockerHub")]),s._v("，当然由于DockerHub在国内访问慢的原因，"),e("strong",[s._v("2.将镜像推送到阿里云的DockerHub仓库")]),s._v("，"),e("strong",[s._v("3.创建一个私有Docker仓库")]),s._v("。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221205105530964.png?aliyun",alt:"image-20221205105530964"}})]),s._v(" "),e("h1",{attrs:{id:"一、使用docker-hub"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、使用docker-hub"}},[s._v("#")]),s._v(" 一、使用Docker Hub")]),s._v(" "),e("p",[s._v("Docker Hub 存放着 Docker镜像 及其组件的所有资源。Docker Hub 可以帮助你与同事之间协作，并获得功能完整的 Docker。为此，它提供的服务有：")]),s._v(" "),e("ul",[e("li",[s._v("Docker 镜像主机")]),s._v(" "),e("li",[s._v("用户认证")]),s._v(" "),e("li",[s._v("自动镜像构建和工作流程工具，如构建触发器和 web hooks")]),s._v(" "),e("li",[s._v("整合了 GitHub 和 BitBucket")])]),s._v(" "),e("h2",{attrs:{id:"_1-创建-docker-hub-账户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-docker-hub-账户"}},[s._v("#")]),s._v(" 1.创建 Docker Hub 账户")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("注册账户"),e("OutboundLink")],1),s._v("： https://hub.docker.com/ ，输入个人信息，如果有账号可以忽略。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203152739869.png?aliyun",alt:"image-20221203152739869"}})]),s._v(" "),e("h2",{attrs:{id:"_2-通过命令来登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过命令来登录"}},[s._v("#")]),s._v(" 2.通过命令来登录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("## 登录\n# docker login\n输入注册的账号和密码\n\n账号是：starb\n\n##退出\n# docker logout\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("输入用户名和密码。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203155516562.png?aliyun",alt:"image-20221203155516562"}})]),s._v(" "),e("h2",{attrs:{id:"_3-给镜像打个标签"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-给镜像打个标签"}},[s._v("#")]),s._v(" 3.给镜像打个标签")]),s._v(" "),e("p",[s._v("你可以给现有的镜像添加标记，然后提交和构建。我们可以使用"),e("code",[s._v("docker tag")]),s._v("命令。让我们给"),e("code",[s._v("training/webapp")]),s._v("镜像添加一个新的标签。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1.拉取镜像：\n# docker pull training/webapp\nTrying to pull repository docker.io/training/webapp\n\n2.查看镜像:\n# docker images training/webapp\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/training/webapp   latest              6fae60ef3446        7 years ago         349 MB\n\n3.重新打镜像：\n# docker tag 6fae60ef3446 starb/webapp:v1.1\n\n4.查看新的标签：\n# docker images starb/webapp\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nnewtag/webapp       v1.1                6fae60ef3446        7 years ago         349 MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:"_4-向docker-hub推送镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-向docker-hub推送镜像"}},[s._v("#")]),s._v(" 4.向Docker Hub推送镜像")]),s._v(" "),e("p",[s._v("一旦你构建或创造一个新的镜像，你可以使用"),e("code",[s._v("docker push")]),s._v("命令推送到Docker Hub。可以对其他人公开进行分享，或把它添加到你的私人仓库中。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker push starb/webapp:v1.1\nThe push refers to a repository [docker.io/newtag/webapp]\n5f70bf18a086: Preparing \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203160125609.png?aliyun",alt:"image-20221203160125609"}})]),s._v(" "),e("p",[s._v("再进入你的dockerHub个人页面")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203160243598.png?aliyun",alt:"image-20221203160243598"}})]),s._v(" "),e("p",[s._v("有了刚才push的镜像。")]),s._v(" "),e("p",[s._v("可以把自己的")]),s._v(" "),e("h2",{attrs:{id:"_5-把镜像设置为私有"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-把镜像设置为私有"}},[s._v("#")]),s._v(" 5.把镜像设置为私有")]),s._v(" "),e("p",[s._v("私有需要登录之后才能拉取，免费的账号私有仓库只能是一个，公共仓库无限制。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203161536173.png?aliyun",alt:"image-20221203161536173"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203161604928.png?aliyun",alt:"image-20221203161604928"}})]),s._v(" "),e("h2",{attrs:{id:"_6-拉取刚才的镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-拉取刚才的镜像"}},[s._v("#")]),s._v(" 6.拉取刚才的镜像")]),s._v(" "),e("p",[s._v("在其他的服务器作为客户端就可以拉取镜像了")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker pull starb/webapp:v1.1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"二、使用阿里云docker镜像仓库加速"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、使用阿里云docker镜像仓库加速"}},[s._v("#")]),s._v(" 二、使用阿里云Docker镜像仓库加速")]),s._v(" "),e("p",[s._v("官方镜像下载有时候实在是慢，于是开通了阿里云开发者帐号。")]),s._v(" "),e("p",[s._v("1.阿里云-云容器Hub服务："),e("a",{attrs:{href:"https://cr.console.aliyun.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://cr.console.aliyun.com/"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("使用方法跟DockerHub大同小异，只是仓库地址改为阿里云的地址，速度比官网杠杠滴。")]),s._v(" "),e("h2",{attrs:{id:"_1-登录阿里云docker-registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-登录阿里云docker-registry"}},[s._v("#")]),s._v(" 1.登录阿里云docker registry:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo docker login --username=funet8@163.com registry.cn-hangzhou.aliyuncs.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("登录registry的用户名是您的阿里云账号全名，密码是您开通服务时设置的密码。")]),s._v(" "),e("p",[s._v("你可以在镜像管理首页点击右上角按钮修改docker login密码。")]),s._v(" "),e("h2",{attrs:{id:"_2-从registry中拉取镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-从registry中拉取镜像"}},[s._v("#")]),s._v(" 2.从registry中拉取镜像：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/funetcentos6/centos7.1:[镜像版本号]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"_3-将镜像推送到registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-将镜像推送到registry"}},[s._v("#")]),s._v(" 3.将镜像推送到registry：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo docker login --username=funet8@163.com registry.cn-hangzhou.aliyuncs.com\n$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/funetcentos6/centos7.1:[镜像版本号]\n$ sudo docker push registry.cn-hangzhou.aliyuncs.com/funetcentos6/centos7.1:[镜像版本号]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("其中[ImageId],[镜像版本号]请你根据自己的镜像信息进行填写。")]),s._v(" "),e("h3",{attrs:{id:"注意您的网络环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意您的网络环境"}},[s._v("#")]),s._v(" "),e("strong",[s._v("注意您的网络环境")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("从ECS推送镜像时，可以选择走内网，速度将大大提升，并且将不会损耗您的公网流量。\n\n如果您申请的机器是在经典网络，请使用 registry-internal.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀\n\n如果您申请的机器是在vpc网络的，请使用 registry-vpc.cn-hangzhou.aliyuncs.com 作为registry的域名登录, 并作为镜像名空间前缀\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("sample:")]),s._v(" "),e("p",[s._v("使用docker tag重命名镜像，并将它通过私网ip推送至registry：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ sudo docker images\n\nREPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nregistry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB\n\n$ sudo docker tag 37bb9c63c8b2 registry..aliyuncs.com/acs/agent:0.7-dfb6816\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h1",{attrs:{id:"三、创建私有仓库registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、创建私有仓库registry"}},[s._v("#")]),s._v(" 三、创建私有仓库registry")]),s._v(" "),e("p",[s._v("有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。")]),s._v(" "),e("h2",{attrs:{id:"安装运行-docker-registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装运行-docker-registry"}},[s._v("#")]),s._v(" 安装运行 docker-registry")]),s._v(" "),e("p",[s._v("你可以使用官方 "),e("code",[s._v("registry")]),s._v(" 镜像来运行。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -p 5000:5000 --restart=always --name registry registry")]),s._v("\n或者：\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d \\")]),s._v("\n-p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /opt/data/registry:/var/lib/registry "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nregistry\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\nac3a01e3641f        registry            "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/entrypoint.sh /e..."')]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" seconds ago       Up "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5000-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   confident_aryabhata\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("这将使用官方的 "),e("code",[s._v("registry")]),s._v(" 镜像来启动私有仓库。默认情况下，仓库会被创建在容器的 "),e("code",[s._v("/var/lib/registry")]),s._v(" 目录下。你可以通过 "),e("code",[s._v("-v")]),s._v(" 参数来将镜像文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 "),e("code",[s._v("/opt/data/registry")]),s._v(" 目录。")]),s._v(" "),e("h2",{attrs:{id:"在私有仓库上传、搜索、下载镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在私有仓库上传、搜索、下载镜像"}},[s._v("#")]),s._v(" 在私有仓库上传、搜索、下载镜像")]),s._v(" "),e("p",[s._v("创建好私有仓库之后，就可以使用 "),e("code",[s._v("docker tag")]),s._v(" 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 "),e("code",[s._v("127.0.0.1:5000")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"查看已有的镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看已有的镜像"}},[s._v("#")]),s._v(" 查看已有的镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker image ls\nREPOSITORY                                         TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/registry                                 latest              81c944c2288b        2 weeks ago         24.1 MB\ndocker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"使用-docker-tag将-adguardhome打标签"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-tag将-adguardhome打标签"}},[s._v("#")]),s._v(" 使用 docker tag将 adguardhome打标签")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("格式为： docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]\n\n# docker tag docker.io/adguard/adguardhome 127.0.0.1:5000/adguardhome:v1.0\n查看：\n# docker images|grep adguardhome\n127.0.0.1:5000/adguardhome                         v1.0                18aae264c84e        8 weeks ago         81 MB\ndocker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"使用-docker-push上传标记的镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-push上传标记的镜像"}},[s._v("#")]),s._v(" 使用 docker push上传标记的镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker push 127.0.0.1:5000/adguardhome:v1.0\nThe push refers to a repository [127.0.0.1:5000/adguardhome]\n5f70bf18a086: Pushed \nd4178a974467: Pushed \n7a26e5e5ccf8: Pushed \ne5bf41d9e3f6: Pushed \n994393dc58e7: Pushed \nv1.0: digest: sha256:2a474fedc96c41c3b1c48d1b1dacbfbe78fb194353dced082914bf5d1e5c2217 size: 1368\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"用-curl-查看仓库中的镜像。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用-curl-查看仓库中的镜像。"}},[s._v("#")]),s._v(" 用 curl 查看仓库中的镜像。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('$ # curl 127.0.0.1:5000/v2/_catalog\n{"repositories":["adguardhome"]}\n\n表明镜像已经被成功上传了。\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("先删除已有镜像，再尝试从私有仓库中下载这个镜像。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("删除镜像：\n# docker image rm 127.0.0.1:5000/adguardhome:v1.0\n# docker images|grep adguardhome\ndocker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB\n\n拉取镜像\n#  docker pull 127.0.0.1:5000/adguardhome:v1.0\nTrying to pull repository 127.0.0.1:5000/adguardhome ... \nv1.0: Pulling from 127.0.0.1:5000/adguardhome\nDigest: sha256:2a474fedc96c41c3b1c48d1b1dacbfbe78fb194353dced082914bf5d1e5c2217\nStatus: Downloaded newer image for 127.0.0.1:5000/adguardhome:v1.0\n\n查看镜像：\n# docker images|grep adguardhome\n127.0.0.1:5000/adguardhome                         v1.0                18aae264c84e        8 weeks ago         81 MB\ndocker.io/adguard/adguardhome                      latest              18aae264c84e        8 weeks ago         81 MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:"配置非-https-仓库地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置非-https-仓库地址"}},[s._v("#")]),s._v(" 配置非 https 仓库地址")]),s._v(" "),e("p",[s._v("如果你不想使用 "),e("code",[s._v("127.0.0.1:5000")]),s._v(" 作为仓库地址，比如想让本网段的其他主机也能把镜像推送到私有仓库。你就得把例如 "),e("code",[s._v("192.168.1.3:5000")]),s._v(" 这样的内网地址作为私有仓库地址，这时你会发现无法成功推送镜像。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker pull 192.168.1.3:5000/adguardhome:v1.0\nTrying to pull repository 192.168.1.3:5000/adguardhome ... \nGet https://192.168.1.3:5000/v1/_ping: http: server gave HTTP response to HTTPS client\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("这是因为 Docker 默认不允许非 "),e("code",[s._v("HTTPS")]),s._v(" 方式推送镜像。我们可以通过 Docker 的配置选项来取消这个限制，或者查看下一节配置能够通过 "),e("code",[s._v("HTTPS")]),s._v(" 访问的私有仓库。")]),s._v(" "),e("h3",{attrs:{id:"ubuntu-16-04-debian-8-centos-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-16-04-debian-8-centos-7"}},[s._v("#")]),s._v(" Ubuntu 16.04+, Debian 8+, centos 7")]),s._v(" "),e("p",[s._v("对于使用 "),e("code",[s._v("systemd")]),s._v(" 的系统，请在 "),e("code",[s._v("/etc/docker/daemon.json")]),s._v(" 中写入如下内容（如果文件不存在请新建该文件）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "registry-mirror": [\n    "https://hub-mirror.c.163.com",\n    "https://mirror.baidubce.com"\n  ],\n  "insecure-registries": [\n    "192.168.1.3:5000"\n  ]\n}\n再重启\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("测试")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# docker pull 192.168.1.3:5000/adguardhome:v1.0\nTrying to pull repository 192.168.1.3:5000/adguardhome ... \nv1.0: Pulling from 192.168.1.3:5000/adguardhome\n213ec9aee27d: Pull complete \n31f9e8542749: Pull complete \n35797e6c4bae: Pull complete \n3c40b1afc955: Download complete \n4f4fb700ef54: Download complete \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h1",{attrs:{id:"docker-镜像加速"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像加速"}},[s._v("#")]),s._v(" Docker 镜像加速")]),s._v(" "),e("p",[s._v("国内从 DockerHub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。Docker 官方和国内很多云服务商都提供了国内加速器服务，例如：")]),s._v(" "),e("p",[s._v("网易：https://hub-mirror.c.163.com/")]),s._v(" "),e("p",[s._v("阿里云：https://<你的ID>.mirror.aliyuncs.com")]),s._v(" "),e("p",[s._v("七牛云加速器：https://reg-mirror.qiniu.com")]),s._v(" "),e("p",[s._v("当配置某一个加速器地址之后，若发现拉取不到镜像，请切换到另一个加速器地址。国内各大云服务商均提供了 Docker 镜像加速服务，建议根据运行 Docker 的云平台选择对应的镜像加速服务。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("https://cr.console.aliyun.com/\n登录：\nhttps://cr.console.aliyun.com/cn-shenzhen/instances/mirrors \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20221203161839102.png?aliyun",alt:"image-20221203161839102"}})]),s._v(" "),e("h2",{attrs:{id:"配置镜像加速器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置镜像加速器"}},[s._v("#")]),s._v(" 配置镜像加速器")]),s._v(" "),e("p",[s._v("针对Docker客户端版本大于 1.10.0 的用户")]),s._v(" "),e("p",[s._v("您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('$ sudo mkdir -p /etc/docker\n$ sudo tee /etc/docker/daemon.json <<-\'EOF\'\n{\n  "registry-mirrors": ["https://otow63ff.mirror.aliyuncs.com"] # 可以设置自己的地址\n}\nEOF\n$ sudo systemctl daemon-reload\n$ sudo systemctl restart docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("以上就是使用DockerHub和用阿里云的DockerHub加速的教程，用好了真的很方便。")])])}),[],!1,null,null,null);a.default=t.exports}}]);