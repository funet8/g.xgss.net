(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{638:function(a,s,e){"use strict";e.r(s);var t=e(17),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"使用dockerfile创建镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用dockerfile创建镜像"}},[a._v("#")]),a._v(" 使用dockerfile创建镜像")]),a._v(" "),e("p",[a._v("文本格式的配置文件，用户可以使用它快速创建自定义的镜像。\ndockerfile分为四部分：基础镜像信息、维护者信息、镜像操作指令、容器启动时执行命令。")]),a._v(" "),e("h2",{attrs:{id:"_1-from-指定基础镜像、必须"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-from-指定基础镜像、必须"}},[a._v("#")]),a._v(" 1.FROM（指定基础镜像、必须）")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("FROM <image>  \nFROM <image>:<tag>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_2-maintainer-用来指定镜像创建者信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-maintainer-用来指定镜像创建者信息"}},[a._v("#")]),a._v(" 2.MAINTAINER（用来指定镜像创建者信息）")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("MAINTAINER star xxx@163.com\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_3-run-安装软件用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-run-安装软件用"}},[a._v("#")]),a._v(" 3.RUN（安装软件用）")]),a._v(" "),e("p",[a._v("每条RUN指令将在当前镜像的基础上执行指令命令，并且提交为新的镜像")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('RUN <command> ; RUN ["executable","param1","param2"]\nRUN apt-get update\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_4-cmd-镜像启动时执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-cmd-镜像启动时执行"}},[a._v("#")]),a._v(" 4.CMD（镜像启动时执行）")]),a._v(" "),e("p",[a._v("每个CMD只能有一条命令，指定多了只有最后一条会被执行")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("CMD /user/sbin/nginx\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_5-label-镜像的元数据标签信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-label-镜像的元数据标签信息"}},[a._v("#")]),a._v(" 5.LABEL(镜像的元数据标签信息)")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('LABEL <key>=<value> <key>=<value>...\n例如：\nLABEL VERSION="1.0"\nLABEL description="this test illustrates"\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("h2",{attrs:{id:"_6-exporse-镜像内监听端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-exporse-镜像内监听端口"}},[a._v("#")]),a._v(" 6.EXPORSE(镜像内监听端口)")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("例如：\nEXPORSE 80 22 443\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_7-env-指定环境变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-env-指定环境变量"}},[a._v("#")]),a._v(" 7.ENV(指定环境变量)")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("格式：\nENV <KEY><VALUE>\nENV PG_MAJOR 9.3\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h2",{attrs:{id:"_8-add-添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-add-添加"}},[a._v("#")]),a._v(" 8.ADD(添加)")]),a._v(" "),e("p",[a._v("可以是dockerfile所在目录的相对路径也可以是一个URL，也可以是个tar包（会自动解压到dest路径下）")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("格式： \nADD <src> <dest>\nADD supervisord.conf /etc/supervisord.conf\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h2",{attrs:{id:"_9-copy-复制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-copy-复制"}},[a._v("#")]),a._v(" 9.COPY(复制)")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("格式： COPY <src> <dest>\n复制本地主机的<src>到镜像中<dest>目录，目标路径不存在会自动创建，当本地目录为源目录时，推荐使用COPY\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_10-entrypoint-镜像启动时执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-entrypoint-镜像启动时执行"}},[a._v("#")]),a._v(" 10.ENTRYPOINT（镜像启动时执行）")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('两种格式：\nENTRYPOINT ["excutable","param1","param2"]   #exec调用执行\nENTRYPOINT command param1 param2\t\t\t #shell中执行\n例如：\nENTRYPOINT ["/usr/bin/supervisord", "-n", "-c", "/etc/supervisord.conf"]\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h2",{attrs:{id:"_11-volume-创建挂载点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-volume-创建挂载点"}},[a._v("#")]),a._v(" 11.VOLUME(创建挂载点)")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('格式： \nVOLUME ["/data"]\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_12-user-指定运行容器的用户名uid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_12-user-指定运行容器的用户名uid"}},[a._v("#")]),a._v(" 12.USER(指定运行容器的用户名uid)")]),a._v(" "),e("p",[a._v("当服务不需要管理员权限的时候，可以通过制定该命令运行用户。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("格式： \nUSER daemon\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"_13-workdir-为后续run、cmd和entrypoint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_13-workdir-为后续run、cmd和entrypoint"}},[a._v("#")]),a._v(" 13.WORKDIR(为后续RUN、CMD和ENTRYPOINT)")]),a._v(" "),e("p",[a._v("指定配置工作目录")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("WORKDIR /path/to/workdir\n\n# 在 /p1/p2 下执行 vim a.txt\nWORKDIR /p1 \nWORKDIR p2 \nRUN vim a.txt\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("h2",{attrs:{id:"_14-arg-指定镜像内的参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14-arg-指定镜像内的参数"}},[a._v("#")]),a._v(" 14.ARG 指定镜像内的参数")]),a._v(" "),e("p",[a._v("这些参数在执行docker build命令时才以 --build-arg"),e("varname",[a._v("="),e("value",[a._v("格式传入。")])],1)],1),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("格式：\nARG<name>[=<default value>]\n则可以用--build-arg<varname>=<value>来指定参数值\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("h2",{attrs:{id:"_15-onbuild-在子镜像中执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15-onbuild-在子镜像中执行"}},[a._v("#")]),a._v(" 15.ONBUILD（在子镜像中执行）")]),a._v(" "),e("p",[a._v("ONBUILD 指定的命令在构建镜像时并不执行，而是在它的子镜像中执行。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("ONBUILD <Dockerfile关键字>  \n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_16-stopsignal-指定容器启动接受退出的信号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_16-stopsignal-指定容器启动接受退出的信号"}},[a._v("#")]),a._v(" 16.STOPSIGNAL（指定容器启动接受退出的信号）")]),a._v(" "),e("p",[a._v("所使用的信号必须是内核系统调用表中的合法的值，如：9、SIGKILL。")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("STOPSIGNAL signal\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_17-healthcheck"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_17-healthcheck"}},[a._v("#")]),a._v(" 17.HEALTHCHECK")]),a._v(" "),e("p",[a._v("（健康检查 1.12以后支持）")]),a._v(" "),e("h2",{attrs:{id:"_18-shell"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_18-shell"}},[a._v("#")]),a._v(" 18.SHELL")]),a._v(" "),e("p",[a._v("（指定其他命令使用shell时的默认类型）")]),a._v(" "),e("h1",{attrs:{id:"dockerfile文件中的cmd和entrypoint指令差异对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile文件中的cmd和entrypoint指令差异对比"}},[a._v("#")]),a._v(" Dockerfile文件中的CMD和ENTRYPOINT指令差异对比")]),a._v(" "),e("p",[a._v("https://www.cnblogs.com/lienhua34/p/5170335.html")]),a._v(" "),e("p",[a._v("CMD指令和ENTRYPOINT指令的作用都是为镜像指定容器启动后的命令，那么它们两者之间有什么各自的优点呢？\n为了更好地对比CMD指令和ENTRYPOINT指令的差异，我们这里再列一下这两个指令的说明")]),a._v(" "),e("h2",{attrs:{id:"cmd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[a._v("#")]),a._v(" "),e("strong",[a._v("CMD")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('支持三种格式\n    CMD ["executable","param1","param2"] 使用 exec 执行，推荐方式；\n    CMD command param1 param2 在 /bin/sh 中执行，提供给需要交互的应用；\n    CMD ["param1","param2"] 提供给 ENTRYPOINT 的默认参数；\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("指定启动容器时执行的命令，每个 Dockerfile 只能有一条 CMD 命令。如果指定了多条命令，只有最后一条会被执行。\n如果用户启动容器时候指定了运行的命令，则会覆盖掉 CMD 指定的命令。")]),a._v(" "),e("h2",{attrs:{id:"entrypoint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[a._v("#")]),a._v(" "),e("strong",[a._v("ENTRYPOINT")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('两种格式：\n    ENTRYPOINT ["executable", "param1", "param2"]\n    ENTRYPOINT command param1 param2（shell中执行）。\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("从上面的说明，我们可以看到有两个共同点：")]),a._v(" "),e("ol",[e("li",[e("strong",[a._v("都可以指定shell或exec函数调用的方式执行命令；")])]),a._v(" "),e("li",[e("strong",[a._v("当存在多个CMD指令或ENTRYPOINT指令时，只有最后一个生效；")])])]),a._v(" "),e("p",[a._v("而它们有如下差异：\n1."),e("strong",[a._v("差异1：CMD指令指定的容器启动时命令可以被docker run指定的命令覆盖，而ENTRYPOINT指令指定的命令不能被覆盖，而是将docker run指定的参数当做ENTRYPOINT指定命令的参数。")]),a._v("\n2."),e("strong",[a._v("差异2：CMD指令可以为ENTRYPOINT指令设置默认参数，而且可以被docker run指定的参数覆盖；")])]),a._v(" "),e("p",[a._v("下面分别对上面两个差异点进行详细说明，")]),a._v(" "),e("h2",{attrs:{id:"差异1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#差异1"}},[a._v("#")]),a._v(" 差异1")]),a._v(" "),e("p",[a._v("CMD指令指定的容器启动时命令可以被docker run指定的命令覆盖；而ENTRYPOINT指令指定的命令不能被覆盖，而是将docker run指定的参数当做ENTRYPOINT指定命令的参数。")])])}),[],!1,null,null,null);s.default=r.exports}}]);