(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{747:function(s,a,t){"use strict";t.r(a);var e=t(17),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"linux使用mail配合smtp发送邮件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux使用mail配合smtp发送邮件"}},[s._v("#")]),s._v(" Linux使用mail配合smtp发送邮件")]),s._v(" "),t("p",[s._v("由于工作需要结合shell脚本需要发送邮件通知，linux自带的mail可以实现外部smtp发邮件。不需要本地配置postfix，sendmail邮件服务器。")]),s._v(" "),t("p",[s._v("本文教程包含25端口发送邮件和mail使用465端口加密发邮件，mail基本命令发送邮件三个知识点，测试系统是centos7")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/Linux-mail-smtp.jpg?aliyun",alt:"Linux-mail-smtp"}})]),s._v(" "),t("h2",{attrs:{id:"安装工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装工具"}},[s._v("#")]),s._v(" 安装工具")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#  yum -y install mailx\n#  yum -y install sendmail\n\ncentos6\n# /etc/init.d/sendmail start\n# chkconfig sendmail on\n\ncentos7\nsystemctl enable sendmail\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("关闭其他的邮件工具")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl stop sendmail\n# systemctl stop postfix\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"开启邮箱imap-smtp服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启邮箱imap-smtp服务"}},[s._v("#")]),s._v(" 开启邮箱imap/smtp服务")]),s._v(" "),t("p",[s._v("我这里使用的是163的邮箱，步骤如下：")]),s._v(" "),t("p",[s._v("1.登录邮箱后，点击页面顶部的“设置”菜单，在下拉框中点击“POP3/SMTP/IMAP”项")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/bVGfyW.png?aliyun",alt:"clipboard.png"}})]),s._v(" "),t("p",[s._v("2.进入到如下页面，勾选"),t("code",[s._v("IMAP/SMTP服务")]),s._v("项，根据步骤完成即可（由于我这里已经开启过，就不再演示了。初始勾选后会让你填写手机号码，发送验证码，成功填写后，会让你输入授权码，这个是作为smtp登录的密码使用的，详情请看163的smtp说明）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/bVGfzo.png?aliyun",alt:"clipboard.png"}})]),s._v(" "),t("p",[s._v("配置发送的邮箱和密码，注意不是你的邮箱登录密码！")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# vi /etc/mail.rc\n\n在底部添加：\nset from="xxx@163.com"\nset smtp=smtp.163.com\nset smtp-auth-user=xxx@163.com\nset smtp-auth-password=自己填写的授权码\nset smtp-auth=login\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"测试发送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试发送"}},[s._v("#")]),s._v(" 测试发送")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('echo -e "你好！n我来看看你n哈哈" | mail -s "测试邮件" shoujianren@163.com\n\nmail  -s "`date +%F-%T`" shoujianren@163.com </tmp/messages.txt\n\necho -e "你好！\\n我来看看你\\n哈哈" | mail -s "测试邮件" xxx@163.com\n\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("有的云服务器商封了25端口。")]),s._v(" "),t("p",[s._v("1.开工单，让客服把25号端口开通，例如阿里云TCP 25端口解封申请 https://help.aliyun.com/knowledge_detail/56130.html")]),s._v(" "),t("p",[s._v("2.使用加密端口发送邮件。")]),s._v(" "),t("h1",{attrs:{id:"mail使用465端口加密发邮件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mail使用465端口加密发邮件"}},[s._v("#")]),s._v(" mail使用465端口加密发邮件")]),s._v(" "),t("p",[s._v("今天由于服务需求，需要服务器需要发送邮件；但是不论用什么办法，发送邮件总是失败；最终发现原因：阿里云实例服务器默认禁止了25端口；")]),s._v(" "),t("h2",{attrs:{id:"关闭其它的邮件工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭其它的邮件工具"}},[s._v("#")]),s._v(" 关闭其它的邮件工具")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl stop sendmail\n# systemctl stop postfix\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"安装mailx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装mailx"}},[s._v("#")]),s._v(" 安装mailx")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum install mailx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"开启smtp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启smtp"}},[s._v("#")]),s._v(" 开启smtp")]),s._v(" "),t("p",[s._v("参考上一步")]),s._v(" "),t("h2",{attrs:{id:"请求数字证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求数字证书"}},[s._v("#")]),s._v(" 请求数字证书")]),s._v(" "),t("p",[s._v("这里用的163邮箱，所以向163请求证书")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# mkdir /root/.certs\n\n# echo -n | openssl s_client -connect smtp.163.com:465 | sed -ne \'/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\' > /root/.certs/163.crt\n\n# certutil -A -n "GeoTrust SSL CA" -t "C,," -d /root/.certs -i /root/.certs/163.crt\n\n# certutil -A -n "GeoTrust Global CA" -t "C,," -d /root/.certs -i /root/.certs/163.crt\n\n# certutil -A -n "GeoTrust SSL CA - G3" -t "Pu,Pu,Pu" -d /root/.certs/./ -i /root/.certs/163.crt\n\n# ls /root/.certs/\n163.crt  cert8.db  key3.db  secmod.db\n\n# certutil -L -d /root/.certs\n\nCertificate Nickname                                         Trust Attributes\n                                                             SSL,S/MIME,JAR/XPI\n\nGeoTrust SSL CA                                              P,P,P\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h2",{attrs:{id:"配置-etc-mail-rc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-etc-mail-rc"}},[s._v("#")]),s._v(" 配置/etc/mail.rc")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# vim /etc/mail.rc\n\nset from=xxx@163.com #之前设置好的邮箱地址\nset smtp="smtps://smtp.163.com:465" #邮件服务器\nset smtp-auth-user=xxx@163.com #之前设置好的邮箱地址\nset smtp-auth-password=xxxx #授权码\nset smtp-auth=login #默认login即可\nset ssl-verify=ignore #ssl认证方式\nset nss-config-dir=/root/.certs #证书所在目录\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"发送邮件测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发送邮件测试"}},[s._v("#")]),s._v(" 发送邮件测试")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# echo "邮件正文" | mail -s "邮件主题" xxx@163.com\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("邮件发送成功")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/image-20220218134340670.png?aliyun",alt:"image-20220218134340670"}})]),s._v(" "),t("h1",{attrs:{id:"mail基本命令发送邮件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mail基本命令发送邮件"}},[s._v("#")]),s._v(" mail基本命令发送邮件")]),s._v(" "),t("p",[s._v('1.标题为"test"内容为空的邮件，容易被邮箱服务判为垃圾邮件。')]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('mail -s "test" username2@163.com\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("2.以文件为内容作为邮件正文：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('echo "222222222" > /root/mail1\nmail -s test username2@163.com < /root/mail1 \nmail -s test2 username1@163.com,username3@163.com < /root/mail1 \n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("3.使用管道进行邮件发送")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('echo "hello,username3...." | mail -s "hello" username3@163.com\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("4.发送附件\n在linux下使用mail命令发送附件也很简单，不过首先需要安装uuencode软件包，这个程序是对二进制文件进行编码使其适合通过邮件进行发送，直接使用centos的yum源可能找不到uuencode命令的包sharutils，我这里使用了网易Yum源。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# yum -y install sharutils\n\n# uuencode /root/mail1 | mail -s "fujian" xxxx@163.com < /root/file1\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("5、使用外部smtp来发送邮件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# vi /etc/mail.rc          #文末添加以下\nset from=username1@163.com \nsmtp=smtp.163.com\nset smtp-auth-user=username1@163.com \nsmtp-auth-password=password \nsmtp-auth=login\n\n# source /etc/mail.rc\t【本人测试，不需要这步即可】\n# mail -s "testmail" username@163.com < /etc/passwd\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);