(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{696:function(a,t,s){"use strict";s.r(t);var e=s(17),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"开源配置管理中心apollo使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开源配置管理中心apollo使用方法"}},[a._v("#")]),a._v(" 开源配置管理中心apollo使用方法")]),a._v(" "),s("h2",{attrs:{id:"什么是apollo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是apollo"}},[a._v("#")]),a._v(" 什么是apollo")]),a._v(" "),s("p",[a._v("Apollo（阿波罗）是一款可靠的分布式配置管理中心，诞生于携程框架研发部，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性，适用于微服务配置管理场景。")]),a._v(" "),s("h2",{attrs:{id:"应用什么场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用什么场景"}},[a._v("#")]),a._v(" 应用什么场景")]),a._v(" "),s("p",[s("strong",[a._v("项目在不同环境对应的不同的配置")]),a._v("，统一管理不同环境、不同集群的配置")]),a._v(" "),s("p",[a._v("Apollo提供了一个统一界面集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。\n同一份代码部署在不同的集群，可以有不同的配置，比如zk的地址等\n通过命名空间（namespace）可以很方便的支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/%E5%9F%BA%E4%BA%8ELinux%E6%90%AD%E5%BB%BA%E5%BC%80%E6%BA%90%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E4%B8%AD%E5%BF%83apollo-16511151656951.jpg?aliyun",alt:"基于Linux搭建开源配置管理中心apollo"}})]),a._v(" "),s("h2",{attrs:{id:"系统介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系统介绍"}},[a._v("#")]),a._v(" 系统介绍")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("系统")]),a._v(" "),s("th",[a._v("Centos7")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("java环境")]),a._v(" "),s("td",[a._v("java1.8")])]),a._v(" "),s("tr",[s("td",[a._v("数据库")]),a._v(" "),s("td",[a._v("MariaDB-10.2.9")])]),a._v(" "),s("tr",[s("td",[a._v("IP")]),a._v(" "),s("td",[a._v("192.168.1.8")])])])]),a._v(" "),s("h1",{attrs:{id:"使用文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用文档"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/apollo-user-guide",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用文档"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"名词解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#名词解释"}},[a._v("#")]),a._v(" 名词解释")]),a._v(" "),s("p",[s("strong",[a._v("普通应用")]),a._v("\n普通应用指的是独立运行的程序，如Web应用程序、带有main函数的程序")]),a._v(" "),s("p",[s("strong",[a._v("公共组件")]),a._v("\n公共组件指的是发布的类库、客户端程序，不会自己独立运行，如Java的jar包、.Net的dll文件")]),a._v(" "),s("h1",{attrs:{id:"普通应用接入指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通应用接入指南"}},[a._v("#")]),a._v(" 普通应用接入指南")]),a._v(" "),s("h2",{attrs:{id:"创建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[a._v("#")]),a._v(" 创建项目")]),a._v(" "),s("p",[a._v("要使用Apollo，第一步需要创建项目。")]),a._v(" "),s("ol",[s("li",[a._v("打开apollo-portal主页")]),a._v(" "),s("li",[a._v("点击“创建项目”")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/create-app-entry.png?aliyun",alt:"create-app-entry"}})]),a._v(" "),s("ol",[s("li",[a._v("输入项目信息\n"),s("ul",[s("li",[a._v("部门：选择应用所在的部门")]),a._v(" "),s("li",[a._v("应用AppId：用来标识应用身份的唯一id，格式为string，需要和客户端app.properties中配置的app.id对应")]),a._v(" "),s("li",[a._v("应用名称：应用名，仅用于界面展示")]),a._v(" "),s("li",[a._v("应用负责人：选择的人默认会成为该项目的管理员，具备项目权限管理、集群创建、Namespace创建等权限")])])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/create-app.png?aliyun",alt:"create-app"}})]),a._v(" "),s("ol",[s("li",[s("p",[a._v("点击提交")]),a._v(" "),s("p",[a._v("创建成功后，会自动跳转到项目首页")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/app-created.png?aliyun",alt:"app-created"}})]),a._v(" "),s("h2",{attrs:{id:"项目权限分配"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目权限分配"}},[a._v("#")]),a._v(" 项目权限分配")]),a._v(" "),s("h3",{attrs:{id:"项目管理员权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目管理员权限"}},[a._v("#")]),a._v(" 项目管理员权限")]),a._v(" "),s("p",[a._v("项目管理员拥有以下权限：")]),a._v(" "),s("ol",[s("li",[a._v("可以管理项目的权限分配")]),a._v(" "),s("li",[a._v("可以创建集群")]),a._v(" "),s("li",[a._v("可以创建Namespace")])]),a._v(" "),s("p",[a._v("创建项目时填写的应用负责人默认会成为项目的管理员之一，如果还需要其他人也成为项目管理员，可以按照下面步骤操作：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("点击页面左侧的“管理项目”")]),a._v(" "),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/app-permission-entry.png?aliyun",alt:"app-permission-entry"}})])])]),a._v(" "),s("li",[s("p",[a._v("搜索需要添加的成员并点击添加")]),a._v(" "),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/app-permission-search-user.png?aliyun",alt:"app-permission-search-user"}})]),a._v(" "),s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/app-permission-user-added.png?aliyun",alt:"app-permission-user-added"}})])])])]),a._v(" "),s("h3",{attrs:{id:"配置编辑、发布权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置编辑、发布权限"}},[a._v("#")]),a._v(" 配置编辑、发布权限")]),a._v(" "),s("p",[a._v("配置权限分为编辑和发布：")]),a._v(" "),s("ul",[s("li",[a._v("编辑权限允许用户在Apollo界面上创建、修改、删除配置\n"),s("ul",[s("li",[a._v("配置修改后只在Apollo界面上变化，不会影响到应用实际使用的配置")])])]),a._v(" "),s("li",[a._v("发布权限允许用户在Apollo界面上发布、回滚配置\n"),s("ul",[s("li",[a._v("配置只有在发布、回滚动作后才会被应用实际使用到")]),a._v(" "),s("li",[a._v("Apollo在用户操作发布、回滚动作后实时通知到应用，并使最新配置生效")])])])]),a._v(" "),s("p",[a._v("项目创建完，默认没有分配配置的编辑和发布权限，需要项目管理员进行授权。")]),a._v(" "),s("ol",[s("li",[a._v("点击application这个namespace的授权按钮\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/namespace-permission-entry.png?aliyun",alt:"namespace-permission-entry"}})])])]),a._v(" "),s("li",[a._v("分配修改权限\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/namespace-permission-edit.png?aliyun",alt:"namespace-permission-edit"}})])])]),a._v(" "),s("li",[a._v("分配发布权限\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/namespace-publish-permission.png?aliyun",alt:"namespace-publish-permission"}})])])])]),a._v(" "),s("h2",{attrs:{id:"添加配置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加配置项"}},[a._v("#")]),a._v(" 添加配置项")]),a._v(" "),s("p",[a._v("编辑配置需要拥有这个Namespace的编辑权限，如果发现没有新增配置按钮，可以找项目管理员授权。")]),a._v(" "),s("h3",{attrs:{id:"通过表格模式添加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过表格模式添加配置"}},[a._v("#")]),a._v(" 通过表格模式添加配置")]),a._v(" "),s("ol",[s("li",[a._v("点击新增配置\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/create-item-entry.png?aliyun",alt:"create-item-entry"}})])])]),a._v(" "),s("li",[a._v("输入配置项\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/create-item-detail.png?aliyun",alt:"create-item-detail"}})])])]),a._v(" "),s("li",[a._v("点击提交\n"),s("ul",[s("li",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/item-created.png?aliyun",alt:"item-created"}})])])])]),a._v(" "),s("h3",{attrs:{id:"通过文本模式编辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过文本模式编辑"}},[a._v("#")]),a._v(" 通过文本模式编辑")]),a._v(" "),s("p",[a._v("Apollo除了支持表格模式，逐个添加、修改配置外，还提供文本模式批量添加、修改。 这个对于从已有的properties文件迁移尤其有用。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("切换到文本编辑模式")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/text-mode-config-overview.png?aliyun",alt:"text-mode-config-overview"}})])]),a._v(" "),s("li",[s("p",[a._v("点击右侧的修改配置按钮")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/text-mode-config-entry.png?aliyun",alt:"text-mode-config-entry"}})])]),a._v(" "),s("li",[s("p",[a._v("输入配置项，并点击提交修改")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/text-mode-config-submit.png?aliyun",alt:"text-mode-config-submit"}})])])]),a._v(" "),s("h2",{attrs:{id:"发布配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布配置"}},[a._v("#")]),a._v(" 发布配置")]),a._v(" "),s("p",[a._v("配置只有在发布后才会真的被应用使用到，所以在编辑完配置后，需要发布配置。")]),a._v(" "),s("p",[a._v("发布配置需要拥有这个Namespace的发布权限，如果发现没有发布按钮，可以找项目管理员授权。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("点击“发布按钮” "),s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/hermes-portal-publish-entry.png?aliyun",alt:"publish-entry"}})])]),a._v(" "),s("li",[s("p",[a._v("填写发布相关信息，点击发布")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/hermes-portal-publish-detail.png?aliyun",alt:"publish-detail"}})])])]),a._v(" "),s("h2",{attrs:{id:"应用读取配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用读取配置"}},[a._v("#")]),a._v(" 应用读取配置")]),a._v(" "),s("p",[a._v("配置发布成功后，应用就可以通过Apollo客户端读取到配置了。")]),a._v(" "),s("p",[a._v("Apollo目前提供Java客户端，具体信息请点击"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/java-sdk-user-guide",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java客户端使用文档"),s("OutboundLink")],1),a._v("：")]),a._v(" "),s("p",[a._v("如果应用使用了其它语言，也可以通过直接访问Http接口获取配置，具体可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/other-language-client-user-guide",target:"_blank",rel:"noopener noreferrer"}},[a._v("其它语言客户端接入指南"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"应用接入apollo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用接入apollo"}},[a._v("#")]),a._v(" 应用接入Apollo")]),a._v(" "),s("p",[a._v("首先需要在Apollo中接入你的应用，具体步骤可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/apollo-user-guide?id=%E4%B8%80%E3%80%81%E6%99%AE%E9%80%9A%E5%BA%94%E7%94%A8%E6%8E%A5%E5%85%A5%E6%8C%87%E5%8D%97",target:"_blank",rel:"noopener noreferrer"}},[a._v("应用接入文档"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"通过带缓存的http接口从apollo读取配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过带缓存的http接口从apollo读取配置"}},[a._v("#")]),a._v(" 通过带缓存的Http接口从Apollo读取配置")]),a._v(" "),s("p",[a._v("该接口会从缓存中获取配置，适合频率较高的配置拉取请求，如简单的每30秒轮询一次配置。")]),a._v(" "),s("p",[a._v("由于缓存最多会有一秒的延时，所以如果需要配合配置推送通知实现实时更新配置的话，请参考通过不带缓存的Http接口从Apollo读取配置")]),a._v(" "),s("h3",{attrs:{id:"http接口说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口说明"}},[a._v("#")]),a._v(" Http接口说明")]),a._v(" "),s("p",[s("strong",[a._v("URL")]),a._v(": {config_server_url}/configfiles/json/{appId}/{clusterName}/{namespaceName}?ip={clientIp}")]),a._v(" "),s("p",[s("strong",[a._v("Method")]),a._v(": GET")]),a._v(" "),s("p",[s("strong",[a._v("参数说明")]),a._v("：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("参数名")]),a._v(" "),s("th",[a._v("是否必须")]),a._v(" "),s("th",[a._v("参数值")]),a._v(" "),s("th",[a._v("备注")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("config_server_url")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("Apollo配置服务的地址")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("appId")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("应用的appId")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("clusterName")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("集群名")]),a._v(" "),s("td",[a._v("一般情况下传入 default 即可。 如果希望配置按集群划分，可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/apollo-user-guide?id=%E4%B8%89%E3%80%81%E9%9B%86%E7%BE%A4%E7%8B%AC%E7%AB%8B%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[a._v("集群独立配置说明"),s("OutboundLink")],1),a._v("做相关配置，然后在这里填入对应的集群名。")])]),a._v(" "),s("tr",[s("td",[a._v("namespaceName")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("Namespace的名字")]),a._v(" "),s("td",[a._v("如果没有新建过Namespace的话，传入application即可。 如果创建了Namespace，并且需要使用该Namespace的配置，则传入对应的Namespace名字。"),s("strong",[a._v("需要注意的是对于properties类型的namespace，只需要传入namespace的名字即可，如application。对于其它类型的namespace，需要传入namespace的名字加上后缀名，如datasources.json")])])]),a._v(" "),s("tr",[s("td",[a._v("ip")]),a._v(" "),s("td",[a._v("否")]),a._v(" "),s("td",[a._v("应用部署的机器ip")]),a._v(" "),s("td",[a._v("这个参数是可选的，用来实现灰度发布。 如果不想传这个参数，请注意URL中从?号开始的query parameters整个都不要出现。")])])])]),a._v(" "),s("h3",{attrs:{id:"http接口返回格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口返回格式"}},[a._v("#")]),a._v(" Http接口返回格式")]),a._v(" "),s("p",[a._v("该Http接口返回的是JSON格式、UTF-8编码，包含了对应namespace中所有的配置项。")]),a._v(" "),s("p",[a._v("返回内容Sample如下：")]),a._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"portal.elastic.document.type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"biz"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"portal.elastic.cluster.name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hermes-es-fws"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("blockquote",[s("p",[a._v("通过"),s("code",[a._v("{config_server_url}/configfiles/{appId}/{clusterName}/{namespaceName}?ip={clientIp}")]),a._v("可以获取到properties形式的配置")])]),a._v(" "),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("由于是Http接口，所以在URL组装OK之后，直接通过浏览器、或者相关的http接口测试工具访问即可。")]),a._v(" "),s("p",[a._v("本地测试：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('# curl http://192.168.1.5:8080/configfiles/json/1001/default/application\n\n{"redis_ip":"192.168.1.12","redis_passwd":"123456","redis_port":"6379"}\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("h2",{attrs:{id:"通过不带缓存的http接口从apollo读取配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过不带缓存的http接口从apollo读取配置"}},[a._v("#")]),a._v(" 通过不带缓存的Http接口从Apollo读取配置")]),a._v(" "),s("p",[a._v("该接口会直接从数据库中获取配置，可以配合配置推送通知实现实时更新配置。")]),a._v(" "),s("h3",{attrs:{id:"http接口说明-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口说明-2"}},[a._v("#")]),a._v(" Http接口说明")]),a._v(" "),s("p",[s("strong",[a._v("URL")]),a._v(": {config_server_url}/configs/{appId}/{clusterName}/{namespaceName}?releaseKey={releaseKey}&ip={clientIp}")]),a._v(" "),s("p",[s("strong",[a._v("Method")]),a._v(": GET")]),a._v(" "),s("p",[s("strong",[a._v("参数说明")]),a._v("：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("参数名")]),a._v(" "),s("th",[a._v("是否必须")]),a._v(" "),s("th",[a._v("参数值")]),a._v(" "),s("th",[a._v("备注")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("config_server_url")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("Apollo配置服务的地址")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("appId")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("应用的appId")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("clusterName")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("集群名")]),a._v(" "),s("td",[a._v("一般情况下传入 default 即可。 如果希望配置按集群划分，可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/apollo-user-guide?id=%E4%B8%89%E3%80%81%E9%9B%86%E7%BE%A4%E7%8B%AC%E7%AB%8B%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[a._v("集群独立配置说明"),s("OutboundLink")],1),a._v("做相关配置，然后在这里填入对应的集群名。")])]),a._v(" "),s("tr",[s("td",[a._v("namespaceName")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("Namespace的名字")]),a._v(" "),s("td",[a._v("如果没有新建过Namespace的话，传入application即可。 如果创建了Namespace，并且需要使用该Namespace的配置，则传入对应的Namespace名字。"),s("strong",[a._v("需要注意的是对于properties类型的namespace，只需要传入namespace的名字即可，如application。对于其它类型的namespace，需要传入namespace的名字加上后缀名，如datasources.json")])])]),a._v(" "),s("tr",[s("td",[a._v("releaseKey")]),a._v(" "),s("td",[a._v("否")]),a._v(" "),s("td",[a._v("上一次的releaseKey")]),a._v(" "),s("td",[a._v("将上一次返回对象中的releaseKey传入即可，用来给服务端比较版本，如果版本比下来没有变化，则服务端直接返回304以节省流量和运算")])]),a._v(" "),s("tr",[s("td",[a._v("ip")]),a._v(" "),s("td",[a._v("否")]),a._v(" "),s("td",[a._v("应用部署的机器ip")]),a._v(" "),s("td",[a._v("这个参数是可选的，用来实现灰度发布。")])])])]),a._v(" "),s("h3",{attrs:{id:"http接口返回格式-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口返回格式-2"}},[a._v("#")]),a._v(" Http接口返回格式")]),a._v(" "),s("p",[a._v("该Http接口返回的是JSON格式、UTF-8编码。")]),a._v(" "),s("p",[a._v("如果配置没有变化（传入的releaseKey和服务端的相等），则返回HttpStatus 304，response body为空。")]),a._v(" "),s("p",[a._v("如果配置有变化，则会返回HttpStatus 200，response body为对应namespace的meta信息以及其中所有的配置项。")]),a._v(" "),s("p",[a._v("返回内容Sample如下：")]),a._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"appId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"100004458"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"cluster"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"default"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"namespaceName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"application"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"configurations"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"portal.elastic.document.type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"biz"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"portal.elastic.cluster.name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hermes-es-fws"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"releaseKey"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"20170430092936-dee2d58e74515ff3"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h3",{attrs:{id:"测试-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("由于是Http接口，所以在URL组装OK之后，直接通过浏览器、或者相关的http接口测试工具访问即可。")]),a._v(" "),s("p",[a._v("本地测试")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('# curl http://192.168.1.5:8080/configs/1001/default/application\n{"appId":"1001","cluster":"default","namespaceName":"application","configurations":{"redis_ip":"192.168.1.12","redis_passwd":"123456","redis_port":"6379"},"releaseKey":"20220330100056-d3ee492df675126d"}\n\n# curl http://192.168.1.5:8080/configs/1001/default/application?releaseKey=20220330100056-d3ee492df675126d\n\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("h2",{attrs:{id:"应用感知配置更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用感知配置更新"}},[a._v("#")]),a._v(" 应用感知配置更新")]),a._v(" "),s("p",[a._v("Apollo提供了基于Http long polling的配置更新推送通知，第三方客户端可以看自己实际的需求决定是否需要使用这个功能。")]),a._v(" "),s("p",[a._v("如果对配置更新时间不是那么敏感的话，可以通过定时刷新来感知配置更新，刷新频率可以视应用自身情况来定，建议在30秒以上。")]),a._v(" "),s("p",[a._v("如果需要做到实时感知配置更新（1秒）的话，可以参考下面的文档实现配置更新推送的功能。")]),a._v(" "),s("h3",{attrs:{id:"配置更新推送实现思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置更新推送实现思路"}},[a._v("#")]),a._v(" 配置更新推送实现思路")]),a._v(" "),s("p",[a._v("这里建议大家可以参考Apollo的Java实现："),s("a",{attrs:{href:"https://github.com/apolloconfig/apollo/blob/master/apollo-client/src/main/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollService.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("RemoteConfigLongPollService.java"),s("OutboundLink")],1),a._v("，代码量200多行，总体上还是比较简单的。")]),a._v(" "),s("h4",{attrs:{id:"初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[a._v("#")]),a._v(" 初始化")]),a._v(" "),s("p",[a._v("首先需要确定哪些namespace需要配置更新推送，Apollo的实现方式是程序第一次获取某个namespace的配置时就会来注册一下，我们就知道有哪些namespace需要配置更新推送了。")]),a._v(" "),s("p",[a._v("初始化后的结果就是得到一个notifications的Map，内容是namespaceName -> notificationId（初始值为-1）。")]),a._v(" "),s("p",[a._v("运行过程中如果发现有新的namespace需要配置更新推送，直接塞到notifications这个Map里面即可。")]),a._v(" "),s("h4",{attrs:{id:"请求服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#请求服务"}},[a._v("#")]),a._v(" 请求服务")]),a._v(" "),s("p",[a._v("有了notifications这个Map之后，就可以请求服务了。这里先描述一下请求服务的逻辑，具体的URL参数和说明请参见后面的接口说明。")]),a._v(" "),s("ol",[s("li",[a._v("请求远端服务，带上自己的应用信息以及notifications信息")]),a._v(" "),s("li",[a._v("服务端针对传过来的每一个namespace和对应的notificationId，检查notificationId是否是最新的")]),a._v(" "),s("li",[a._v("如果都是最新的，则保持住请求60秒，如果60秒内没有配置变化，则返回HttpStatus 304。如果60秒内有配置变化，则返回对应namespace的最新notificationId, HttpStatus 200。")]),a._v(" "),s("li",[a._v("如果传过来的notifications信息中发现有notificationId比服务端老，则直接返回对应namespace的最新notificationId, HttpStatus 200。")]),a._v(" "),s("li",[a._v("客户端拿到服务端返回后，判断返回的HttpStatus")]),a._v(" "),s("li",[a._v("如果返回的HttpStatus是304，说明配置没有变化，重新执行第1步")]),a._v(" "),s("li",[a._v("如果返回的HttpStauts是200，说明配置有变化，针对变化的namespace重新去服务端拉取配置，参见"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/other-language-client-user-guide?id=_13-%E9%80%9A%E8%BF%87%E4%B8%8D%E5%B8%A6%E7%BC%93%E5%AD%98%E7%9A%84http%E6%8E%A5%E5%8F%A3%E4%BB%8Eapollo%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[a._v("1.3 通过不带缓存的Http接口从Apollo读取配置"),s("OutboundLink")],1),a._v("。同时更新notifications map中的notificationId。重新执行第1步。")])]),a._v(" "),s("h3",{attrs:{id:"http接口说明-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口说明-3"}},[a._v("#")]),a._v(" Http接口说明")]),a._v(" "),s("p",[s("strong",[a._v("URL")]),a._v(": {config_server_url}/notifications/v2?appId={appId}&cluster={clusterName}&notifications={notifications}")]),a._v(" "),s("p",[s("strong",[a._v("Method")]),a._v(": GET")]),a._v(" "),s("p",[s("strong",[a._v("参数说明")]),a._v("：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("参数名")]),a._v(" "),s("th",[a._v("是否必须")]),a._v(" "),s("th",[a._v("参数值")]),a._v(" "),s("th",[a._v("备注")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("config_server_url")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("Apollo配置服务的地址")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("appId")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("应用的appId")]),a._v(" "),s("td")]),a._v(" "),s("tr",[s("td",[a._v("clusterName")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("集群名")]),a._v(" "),s("td",[a._v("一般情况下传入 default 即可。 如果希望配置按集群划分，可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/apollo-user-guide?id=%E4%B8%89%E3%80%81%E9%9B%86%E7%BE%A4%E7%8B%AC%E7%AB%8B%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[a._v("集群独立配置说明"),s("OutboundLink")],1),a._v("做相关配置，然后在这里填入对应的集群名。")])]),a._v(" "),s("tr",[s("td",[a._v("notifications")]),a._v(" "),s("td",[a._v("是")]),a._v(" "),s("td",[a._v("notifications信息")]),a._v(" "),s("td",[a._v('传入本地的notifications信息，注意这里需要以array形式转为json传入，如：[{"namespaceName": "application", "notificationId": 100}, {"namespaceName": "FX.apollo", "notificationId": 200}]。'),s("strong",[a._v("需要注意的是对于properties类型的namespace，只需要传入namespace的名字即可，如application。对于其它类型的namespace，需要传入namespace的名字加上后缀名，如datasources.json")])])])])]),a._v(" "),s("blockquote",[s("p",[a._v("注1：由于服务端会hold住请求60秒，所以请确保客户端访问服务端的超时时间要大于60秒。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注2：别忘了对参数进行"),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Percent-encoding",target:"_blank",rel:"noopener noreferrer"}},[a._v("url encode"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"http接口返回格式-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http接口返回格式-3"}},[a._v("#")]),a._v(" Http接口返回格式")]),a._v(" "),s("p",[a._v("该Http接口返回的是JSON格式、UTF-8编码，包含了有变化的namespace和最新的notificationId。")]),a._v(" "),s("p",[a._v("返回内容Sample如下：")]),a._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"namespaceName"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"application"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[a._v('"notificationId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("101")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"测试-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试-3"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),s("p",[a._v("由于是Http接口，所以在URL组装OK之后，直接通过浏览器、或者相关的http接口测试工具访问即可。")]),a._v(" "),s("h2",{attrs:{id:"配置访问密钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置访问密钥"}},[a._v("#")]),a._v(" 配置访问密钥")]),a._v(" "),s("p",[a._v("Apollo从1.6.0版本开始增加访问密钥机制，从而只有经过身份验证的客户端才能访问敏感配置。如果应用开启了访问密钥，客户端发出请求时需要增加签名，否则无法获取配置。")]),a._v(" "),s("p",[a._v("需要设置的Header信息：")]),a._v(" "),s("table",[s("thead",[s("tr",[s("th",[a._v("Header")]),a._v(" "),s("th",[a._v("Value")]),a._v(" "),s("th",[a._v("备注")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("Authorization")]),a._v(" "),s("td",[a._v("Apollo ${appId}😒{signature}")]),a._v(" "),s("td",[a._v("appId: 应用的appId，signature：使用访问密钥对当前时间以及所访问的URL加签后的值，具体实现可以参考"),s("a",{attrs:{href:"https://github.com/apolloconfig/apollo/blob/aa184a2e11d6e7e3f519d860d69f3cf30ccfcf9c/apollo-core/src/main/java/com/ctrip/framework/apollo/core/signature/Signature.java#L22",target:"_blank",rel:"noopener noreferrer"}},[a._v("Signature.signature"),s("OutboundLink")],1)])]),a._v(" "),s("tr",[s("td",[a._v("Timestamp")]),a._v(" "),s("td",[a._v("从"),s("code",[a._v("1970-1-1 00:00:00 UTC+0")]),a._v("到现在所经过的毫秒数")]),a._v(" "),s("td",[a._v("可以参考"),s("a",{attrs:{href:"https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#currentTimeMillis()",target:"_blank",rel:"noopener noreferrer"}},[a._v("System.currentTimeMillis"),s("OutboundLink")],1)])])])]),a._v(" "),s("p",[a._v("本地测试")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('# curl\nhttp://192.168.1.5:8080/configfiles/json/1001/default/application\n{"timestamp":"2022-03-30T16:39:11.912+0800","status":401,"error":"Unauthorized","message":"","path":"/configfiles/json/1001/default/application"}\n报错 401\n\n密钥： da01f4aab45d4e3c8b8764d99f9a31f5\n\n\n\n\n获取时间戳： Timestamp=`date +%s`\n\ncurl http://192.168.1.5:8080/configfiles/json/1001/default/application -X POST -H "Content-type:application/json" -d \'{"Authorization":"Apollo 1001:da01f4aab45d4e3c8b8764d99f9a31f5","Timestamp":"1648630422"}\'\n\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br")])]),s("h2",{attrs:{id:"错误码说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误码说明"}},[a._v("#")]),a._v(" 错误码说明")]),a._v(" "),s("p",[a._v("正常情况下，接口返回的Http状态码是200，下面列举了Apollo会返回的非200错误码说明。")]),a._v(" "),s("h3",{attrs:{id:"_400-bad-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_400-bad-request"}},[a._v("#")]),a._v(" 400 - Bad Request")]),a._v(" "),s("p",[a._v("客户端传入参数的错误，如必选参数没有传入等，客户端需要根据提示信息检查对应的参数是否正确。")]),a._v(" "),s("h3",{attrs:{id:"_401-unauthorized"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_401-unauthorized"}},[a._v("#")]),a._v(" 401 - Unauthorized")]),a._v(" "),s("p",[a._v("客户端未授权，如服务端配置了访问密钥，客户端未配置或配置错误。")]),a._v(" "),s("h3",{attrs:{id:"_404-not-found"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_404-not-found"}},[a._v("#")]),a._v(" 404 - Not Found")]),a._v(" "),s("p",[a._v("接口要访问的资源不存在，一般是URL或URL的参数错误，或者是对应的namespace还没有发布过配置。")]),a._v(" "),s("h3",{attrs:{id:"_405-method-not-allowed"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_405-method-not-allowed"}},[a._v("#")]),a._v(" 405 - Method Not Allowed")]),a._v(" "),s("p",[a._v("接口访问的Method不正确，比如应该使用GET的接口使用了POST访问等，客户端需要检查接口访问方式是否正确。")]),a._v(" "),s("h3",{attrs:{id:"_500-internal-server-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_500-internal-server-error"}},[a._v("#")]),a._v(" 500 - Internal Server Error")]),a._v(" "),s("p",[a._v("其它类型的错误默认都会返回500，对这类错误如果应用无法根据提示信息找到原因的话，可以尝试查看服务端日志来排查问题。")]),a._v(" "),s("h1",{attrs:{id:"apollo使用场景和示例代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo使用场景和示例代码"}},[a._v("#")]),a._v(" Apollo使用场景和示例代码")]),a._v(" "),s("p",[a._v("https://github.com/ctripcorp/apollo-use-cases")]),a._v(" "),s("h1",{attrs:{id:"apollo-实践案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo-实践案例"}},[a._v("#")]),a._v(" Apollo 实践案例")]),a._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/VHugn0vgNu4m56V49geC4w",target:"_blank",rel:"noopener noreferrer"}},[a._v("Apollo+ES源码改造，构建民生银行的ELK日志平台配置管理中心"),s("OutboundLink")],1)])]),a._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/Ge14UeY9Gm2Hrk--E47eJQ",target:"_blank",rel:"noopener noreferrer"}},[a._v("Apollo在有赞的实践"),s("OutboundLink")],1)])]),a._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://blog.llyweb.com/articles/2020/08/11/1597149013480.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("微服务版本切换初始设计思路"),s("OutboundLink")],1)])]),a._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://anilople.github.io/Sentinel",target:"_blank",rel:"noopener noreferrer"}},[a._v("Alibaba Sentinel Push模式 规则推送至Apollo配置中心"),s("OutboundLink")],1)])])]),a._v(" "),s("h1",{attrs:{id:"apollo-安全相关最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo-安全相关最佳实践"}},[a._v("#")]),a._v(" Apollo 安全相关最佳实践")]),a._v(" "),s("h2",{attrs:{id:"配置查看权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置查看权限"}},[a._v("#")]),a._v(" 配置查看权限")]),a._v(" "),s("p",[a._v("从1.1.0版本开始，apollo-portal增加了查看权限的支持，可以支持配置某个环境只允许项目成员查看私有Namespace的配置。")]),a._v(" "),s("p",[a._v("这里的项目成员是指：")]),a._v(" "),s("ol",[s("li",[a._v("项目的管理员")]),a._v(" "),s("li",[a._v("具备该私有Namespace在该环境下的修改或发布权限")])]),a._v(" "),s("p",[a._v("配置方式很简单，用超级管理员账号登录后，进入"),s("code",[a._v("管理员工具 - 系统参数")]),a._v("页面新增或修改"),s("code",[a._v("configView.memberOnly.envs")]),a._v("配置项即可。")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/46456519-c155e100-c7e1-11e8-969b-8f332379fa29.png?aliyun",alt:"configView.memberOnly.envs"}})]),a._v(" "),s("h2",{attrs:{id:"配置访问密钥-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置访问密钥-2"}},[a._v("#")]),a._v(" 配置访问密钥")]),a._v(" "),s("p",[a._v("Apollo从1.6.0版本开始增加访问密钥机制，从而只有经过身份验证的客户端才能访问敏感配置。如果应用开启了访问密钥，客户端需要配置密钥，否则无法获取配置。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("项目管理员打开管理密钥页面")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/94990081-f4d3cd80-05ab-11eb-9470-fed5ec6de92e-164861936808620.png?aliyun",alt:"94990081-f4d3cd80-05ab-11eb-9470-fed5ec6de92e-164861936808620"}})])]),a._v(" "),s("li",[s("p",[a._v("为项目的每个环境生成访问密钥，注意默认是禁用的，建议在客户端都配置完成后再开启")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/94990150-788dba00-05ac-11eb-9a12-727fdb872e42-164861936808621.png?aliyun",alt:"94990150-788dba00-05ac-11eb-9a12-727fdb872e42-164861936808621"}})])])]),a._v(" "),s("h1",{attrs:{id:"客户端配置访问密钥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置访问密钥"}},[a._v("#")]),a._v(" 客户端配置访问密钥")]),a._v(" "),s("blockquote",[s("p",[a._v("适用于1.6.0及以上版本")])]),a._v(" "),s("p",[a._v("Apollo从1.6.0版本开始增加访问密钥机制，从而只有经过身份验证的客户端才能访问敏感配置。如果应用开启了访问密钥，客户端需要配置密钥，否则无法获取配置。")]),a._v(" "),s("p",[a._v("配置方式按照优先级从高到低分别为：")]),a._v(" "),s("p",[a._v("1.通过Java System Property")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('通过Java System Propertyapollo.access-key.secret(1.9.0+) 或者 apollo.accesskey.secret(1.9.0之前)\n可以通过Java的System Property apollo.access-key.secret(1.9.0+) 或者 apollo.accesskey.secret(1.9.0之前)来指定\n在Java程序启动脚本中，可以指定-Dapollo.access-key.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0+) 或者 -Dapollo.accesskey.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0之前)\n如果是运行jar文件，需要注意格式是java -Dapollo.access-key.secret=1cf998c4e2ad4704b45a98a509d15719 -jar xxx.jar(1.9.0+) 或者 java -Dapollo.accesskey.secret=1cf998c4e2ad4704b45a98a509d15719 -jar xxx.jar(1.9.0之前)\n\n也可以通过程序指定，如System.setProperty("apollo.access-key.secret", "1cf998c4e2ad4704b45a98a509d15719");(1.9.0+) 或者 System.setProperty("apollo.accesskey.secret", "1cf998c4e2ad4704b45a98a509d15719");(1.9.0之前)\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("2.通过Spring Boot的配置文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("可以在Spring Boot的application.properties或bootstrap.properties中指定apollo.access-key.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0+) 或者 apollo.accesskey.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0之前)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("3.通过操作系统的System Environment")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[a._v("还可以通过操作系统的System Environment APOLLO_ACCESS_KEY_SECRET(1.9.0+) 或者 APOLLO_ACCESSKEY_SECRET(1.9.0之前)来指定\n注意key为全大写\n")])])]),s("p",[a._v("4.通过app.properties配置文件")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("可以在classpath:/META-INF/app.properties指定apollo.access-key.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0+) 或者 apollo.accesskey.secret=1cf998c4e2ad4704b45a98a509d15719(1.9.0之前)\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h1",{attrs:{id:"自定义server-properties路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义server-properties路径"}},[a._v("#")]),a._v(" 自定义server.properties路径")]),a._v(" "),s("blockquote",[s("p",[a._v("适用于1.8.0及以上版本")])]),a._v(" "),s("p",[a._v("1.8.0版本开始支持以下方式自定义server.properties路径，按照优先级从高到低分别为：")]),a._v(" "),s("p",[a._v("一.通过Java System Property apollo.path.server.properties")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('1.可以通过Java的System Property apollo.path.server.properties来指定\n\n2.在Java程序启动脚本中，可以指定-Dapollo.path.server.properties=/some-dir/some-file.properties\n如果是运行jar文件，需要注意格式是java -Dapollo.path.server.properties=/some-dir/some-file.properties -jar xxx.jar\n\n3.也可以通过程序指定，如System.setProperty("apollo.path.server.properties", "/some-dir/some-file.properties");\n\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("二、通过操作系统的System EnvironmentAPOLLO_PATH_SERVER_PROPERTIES")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("可以通过操作系统的System Environment APOLLO_PATH_SERVER_PROPERTIES来指定\n注意key为全大写，且中间是_分隔\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h1",{attrs:{id:"客户端用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端用法"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/java-sdk-user-guide?id=%E4%B8%89%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%94%A8%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[a._v("客户端用法"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Apollo支持API方式和Spring整合方式，该怎么选择用哪一种方式？")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("API方式灵活，功能完备，配置值实时更新（热发布），支持所有Java环境。")])]),a._v(" "),s("li",[s("p",[a._v("Spring方式接入简单，结合Spring有N种酷炫的玩法，如")]),a._v(" "),s("ul",[s("li",[a._v("Placeholder方式：\n"),s("ul",[s("li",[a._v("代码中直接使用，如："),s("code",[a._v('@Value("${someKeyFromApollo:someDefaultValue}")')])]),a._v(" "),s("li",[a._v("配置文件中使用替换placeholder，如："),s("code",[a._v("spring.datasource.url: ${someKeyFromApollo:someDefaultValue}")])]),a._v(" "),s("li",[a._v("直接托管spring的配置，如在apollo中直接配置"),s("code",[a._v("spring.datasource.url=jdbc:mysql://localhost:3306/somedb?characterEncoding=utf8")])])])]),a._v(" "),s("li",[a._v("Spring boot的"),s("a",{attrs:{href:"http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/context/properties/ConfigurationProperties.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("@ConfigurationProperties"),s("OutboundLink")],1),a._v("方式")]),a._v(" "),s("li",[a._v("从v0.10.0开始的版本支持placeholder在运行时自动更新，具体参见"),s("a",{attrs:{href:"https://github.com/apolloconfig/apollo/pull/972",target:"_blank",rel:"noopener noreferrer"}},[a._v("PR #972"),s("OutboundLink")],1),a._v("。（v0.10.0之前的版本在配置变化后不会重新注入，需要重启才会更新，如果需要配置值实时更新，可以参考后续"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/java-sdk-user-guide?id=_322-spring-placeholder%E7%9A%84%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"}},[a._v("3.2.2 Spring Placeholder的使用"),s("OutboundLink")],1),a._v("的说明）")])])]),a._v(" "),s("li",[s("p",[a._v("Spring方式也可以结合API方式使用，如注入Apollo的Config对象，就可以照常通过API方式获取配置了：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@ApolloConfig")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//inject config for namespace application点击复制错误复制成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])])]),a._v(" "),s("h2",{attrs:{id:"api使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api使用方式"}},[a._v("#")]),a._v(" API使用方式")]),a._v(" "),s("p",[a._v("API方式是最简单、高效使用Apollo配置的方式，不依赖Spring框架即可使用。")]),a._v(" "),s("h3",{attrs:{id:"获取默认namespace的配置-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取默认namespace的配置-application"}},[a._v("#")]),a._v(" 获取默认namespace的配置（application）")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//config instance is singleton for each namespace and is never null")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" someKey "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"someKeyFromDefaultNamespace"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" someDefaultValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"someDefaultValueForTheKey"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("someKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" someDefaultValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("通过上述的"),s("strong",[a._v("config.getProperty")]),a._v("可以获取到someKey对应的实时最新的配置值。")]),a._v(" "),s("p",[a._v("另外，配置值从内存中获取，所以不需要应用自己做缓存。")]),a._v(" "),s("h1",{attrs:{id:"go、python、nodejs、php等客户端使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#go、python、nodejs、php等客户端使用"}},[a._v("#")]),a._v(" Go、Python、Nodejs、PHP等客户端使用")]),a._v(" "),s("p",[a._v("对应开发语言支持：https://www.apolloconfig.com/#/zh/usage/third-party-sdks-user-guide")]),a._v(" "),s("h3",{attrs:{id:"apollo-php-客户端-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo-php-客户端-1"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/third-party-sdks-user-guide?id=apollo-php-%E5%AE%A2%E6%88%B7%E7%AB%AF-1",target:"_blank",rel:"noopener noreferrer"}},[a._v("Apollo PHP 客户端 1"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("项目地址："),s("a",{attrs:{href:"https://github.com/multilinguals/apollo-php-client",target:"_blank",rel:"noopener noreferrer"}},[a._v("apollo-php-client"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"apollo-php-客户端-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo-php-客户端-2"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/third-party-sdks-user-guide?id=apollo-php-%E5%AE%A2%E6%88%B7%E7%AB%AF-2",target:"_blank",rel:"noopener noreferrer"}},[a._v("Apollo PHP 客户端 2"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("项目地址："),s("a",{attrs:{href:"https://github.com/fengzhibin/apollo-sdk-config",target:"_blank",rel:"noopener noreferrer"}},[a._v("apollo-sdk-config"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("项目地址："),s("a",{attrs:{href:"https://github.com/fengzhibin/apollo-sdk-clientd",target:"_blank",rel:"noopener noreferrer"}},[a._v("apollo-sdk-clientd"),s("OutboundLink")],1)]),a._v(" "),s("h1",{attrs:{id:"什么是namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是namespace"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/design/apollo-core-concept-namespace?id=_1-%e4%bb%80%e4%b9%88%e6%98%afnamespace",target:"_blank",rel:"noopener noreferrer"}},[a._v("什么是Namespace"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Namespace是配置项的集合，类似于一个配置文件的概念。")]),a._v(" "),s("p",[a._v("个人觉得也是Apollo的比较重要和核心的知识点！")]),a._v(" "),s("h2",{attrs:{id:"什么是-application-的namespace"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-application-的namespace"}},[a._v("#")]),a._v(" 什么是“application”的Namespace")]),a._v(" "),s("p",[a._v("Apollo在创建项目的时候，都会默认创建一个“application”的Namespace。顾名思义，“application”是给应用自身使用的，熟悉Spring Boot的同学都知道，Spring Boot项目都有一个默认配置文件application.yml。在这里application.yml就等同于“application”的Namespace。对于90%的应用来说，“application”的Namespace已经满足日常配置使用场景了。")]),a._v(" "),s("h4",{attrs:{id:"客户端获取-application-namespace的代码如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端获取-application-namespace的代码如下"}},[a._v("#")]),a._v(" 客户端获取“application” Namespace的代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"客户端获取非-application-namespace的代码如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端获取非-application-namespace的代码如下"}},[a._v("#")]),a._v(" 客户端获取非“application” Namespace的代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("namespaceName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"namespace的格式有哪些"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace的格式有哪些"}},[a._v("#")]),a._v(" Namespace的格式有哪些？")]),a._v(" "),s("p",[a._v("配置文件有多种格式，例如：properties、xml、yml、yaml、json等。同样Namespace也具有这些格式。在Portal UI中可以看到“application”的Namespace上有一个“properties”标签，表明“application”是properties格式的。")]),a._v(" "),s("blockquote",[s("p",[a._v("注1：非properties格式的namespace，在客户端使用时需要调用"),s("code",[a._v("ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)")]),a._v("来获取，如果使用"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/other-language-client-user-guide?id=_12-%E9%80%9A%E8%BF%87%E5%B8%A6%E7%BC%93%E5%AD%98%E7%9A%84http%E6%8E%A5%E5%8F%A3%E4%BB%8Eapollo%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[a._v("Http接口直接调用"),s("OutboundLink")],1),a._v("时，对应的namespace参数需要传入namespace的名字加上后缀名，如datasources.json。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注2：apollo-client 1.3.0版本开始对yaml/yml做了更好的支持，使用起来和properties格式一致："),s("code",[a._v('Config config = ConfigService.getConfig("application.yml");')]),a._v("，Spring的注入方式也和properties一致。")])]),a._v(" "),s("h2",{attrs:{id:"namespace的获取权限分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace的获取权限分类"}},[a._v("#")]),a._v(" Namespace的获取权限分类")]),a._v(" "),s("p",[s("strong",[a._v("private （私有的）")])]),a._v(" "),s("p",[s("strong",[a._v("public （公共的）")])]),a._v(" "),s("p",[a._v("这里的获取权限是相对于Apollo客户端来说的。")]),a._v(" "),s("p",[a._v("private权限的Namespace："),s("strong",[a._v("只能被所属的应用获取到。一个应用尝试获取其它应用private的Namespace，Apollo会报“404”异常。")])]),a._v(" "),s("p",[a._v("public权限的Namespace： "),s("strong",[a._v("能被任何应用获取。")])]),a._v(" "),s("h2",{attrs:{id:"namespace的类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace的类型"}},[a._v("#")]),a._v(" Namespace的类型")]),a._v(" "),s("p",[a._v("Namespace类型有三种：")]),a._v(" "),s("h3",{attrs:{id:"私有类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#私有类型"}},[a._v("#")]),a._v(" 私有类型")]),a._v(" "),s("p",[s("strong",[a._v("具有private权限。例如上文提到的“application” Namespace就是私有类型。")])]),a._v(" "),s("h3",{attrs:{id:"公共类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#公共类型"}},[a._v("#")]),a._v(" 公共类型")]),a._v(" "),s("p",[s("strong",[a._v("具有public权限。公共类型的Namespace相当于游离于应用之外的配置，且通过Namespace的名称去标识公共Namespace，所以公共的Namespace的名称必须全局唯一。")])]),a._v(" "),s("p",[a._v("使用场景：部门级别共享的配置、小组级别共享的配置、几个项目之间共享的配置、中间件客户端的配置。")]),a._v(" "),s("h3",{attrs:{id:"关联类型-继承类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关联类型-继承类型"}},[a._v("#")]),a._v(" 关联类型（继承类型）")]),a._v(" "),s("p",[a._v("关联类型又可称为继承类型，关联类型具有private权限。关联类型的Namespace继承于公共类型的Namespace，用于覆盖公共Namespace的某些配置。")]),a._v(" "),s("p",[a._v("例如公共的Namespace有两个配置项")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("k1 = v1\nk2 = v2\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("然后应用A有一个关联类型的Namespace关联了此公共Namespace，且覆盖了配置项k1，新值为v3。那么在应用A实际运行时，获取到的公共Namespace的配置为：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("k1 = v3\nk2 = v2\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("关联类型使用场景：")]),a._v(" "),s("p",[a._v("举一个实际使用的场景。假设RPC框架的配置（如：timeout）有以下要求：")]),a._v(" "),s("ul",[s("li",[a._v("提供一份全公司默认的配置且可动态调整")]),a._v(" "),s("li",[a._v("RPC客户端项目可以自定义某些配置项且可动态调整")])]),a._v(" "),s("ol",[s("li",[a._v("如果把以上两点要求去掉“动态调整”，那么做法很简单。在rpc-client.jar包里有一份配置文件，每次修改配置文件然后重新发一个版本的jar包即可。同理，客户端项目修改配置也是如此。")]),a._v(" "),s("li",[a._v("如果只支持客户端项目可动态调整配置。客户端项目可以在Apollo “application” Namespace上配置一些配置项。在初始化service的时候，从Apollo上读取配置即可。这样做的坏处就是，每个项目都要自定义一些key，不统一。")]),a._v(" "),s("li",[a._v("那么如何完美支持以上需求呢？答案就是结合使用Apollo的公共类型的Namespace和关联类型的Namespace。RPC团队在Apollo上维护一个叫“rpc-client”的公共Namespace，在“rpc-client” Namespace上配置默认的参数值。rpc-client.jar里的代码读取“rpc-client”Namespace的配置即可。如果需要调整默认的配置，只需要修改公共类型“rpc-client” Namespace的配置。如果客户端项目想要自定义或动态修改某些配置项，只需要在Apollo 自己项目下关联“rpc-client”，就能创建关联类型“rpc-client”的Namespace。然后在关联类型“rpc-client”的Namespace下修改配置项即可。这里有一点需要指出的，那就是rpc-client.jar是在应用容器里运行的，所以rpc-client获取到的“rpc-client” Namespace的配置是应用的关联类型的Namespace加上公共类型的Namespace。")])]),a._v(" "),s("h4",{attrs:{id:"例子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/design/apollo-core-concept-namespace?id=_54-%E4%BE%8B%E5%AD%90",target:"_blank",rel:"noopener noreferrer"}},[a._v("例子"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("如下图所示，有三个应用：应用A、应用B、应用C。")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("应用A有两个私有类型的Namespace：application和NS-Private，以及一个关联类型的Namespace：NS-Public。")])]),a._v(" "),s("li",[s("p",[a._v("应用B有一个私有类型的Namespace：application，以及一个公共类型的Namespace：NS-Public。")])]),a._v(" "),s("li",[s("p",[a._v("应用C只有一个私有类型的Namespace：application")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://imgoss.xgss.net/picgo/namespace-model-example.png?aliyun",alt:"Namespace例子"}})])])]),a._v(" "),s("h5",{attrs:{id:"应用a获取apollo配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用a获取apollo配置"}},[a._v("#")]),a._v(" 应用A获取Apollo配置")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//application ")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" appConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k1 = v11")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k2 = v21")]),a._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Private")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" privateConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Private"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  privateConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k1 = v3")]),a._v("\n  privateConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k3 = v4")]),a._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Public，覆盖公共类型配置的情况，k4被覆盖")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" publicConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Public"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k4 = v6 cover")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k6 = v6")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k7"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k7 = v7点击复制错误复制成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h5",{attrs:{id:"应用b获取apollo配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用b获取apollo配置"}},[a._v("#")]),a._v(" 应用B获取Apollo配置")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//application")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" appConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k1 = v12")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k2 = null")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k3 = v32")]),a._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Private，由于没有NS-Private Namespace 所以获取到default value")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" privateConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Private"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  privateConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"default value"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Public")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" publicConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Public"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k4 = v5")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k6 = v6")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k7"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k7 = v7点击复制错误复制成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h5",{attrs:{id:"应用c获取apollo配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用c获取apollo配置"}},[a._v("#")]),a._v(" 应用C获取Apollo配置")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//application")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" appConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k1 = v12")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k2 = null")]),a._v("\n  appConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k3 = v33")]),a._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Private，由于没有NS-Private Namespace 所以获取到default value")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" privateConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Private"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  privateConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"default value"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//NS-Public，公共类型的Namespace，任何项目都可以获取到")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" publicConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Public"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k4 = v5")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k6 = v6")]),a._v("\n  publicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getProperty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"k7"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// k7 = v7点击复制错误复制成功")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br")])]),s("h5",{attrs:{id:"changelistener"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#changelistener"}},[a._v("#")]),a._v(" ChangeListener")]),a._v(" "),s("p",[a._v("以上代码例子中可以看到，在客户端Namespace映射成一个Config对象。Namespace配置变更的监听器是注册在Config对象上。")]),a._v(" "),s("p",[a._v("所以在应用A中监听application的Namespace代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" appConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getAppConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nappConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onChange")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeEvent")]),a._v(" changeEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//do something")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("在应用A中监听NS-Private的Namespace代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" privateConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Private"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nprivateConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onChange")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeEvent")]),a._v(" changeEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//do something")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("在应用A、应用B、应用C中监听NS-Public的Namespace代码如下：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Config")]),a._v(" publicConfig "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NS-Public"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\npublicConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onChange")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ConfigChangeEvent")]),a._v(" changeEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//do something")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h1",{attrs:{id:"调整apolloconfigdb配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整apolloconfigdb配置"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_32-%E8%B0%83%E6%95%B4apolloconfigdb%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[a._v("调整ApolloConfigDB配置"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("配置项统一存储在ApolloConfigDB.ServerConfig表中，需要注意每个环境的ApolloConfigDB.ServerConfig都需要单独配置，修改完一分钟实时生效。")]),a._v(" "),s("h2",{attrs:{id:"namespace-lock-switch-一次发布只能有一个人修改开关-用于发布审核"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#namespace-lock-switch-一次发布只能有一个人修改开关-用于发布审核"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_322-namespacelockswitch-%E4%B8%80%E6%AC%A1%E5%8F%91%E5%B8%83%E5%8F%AA%E8%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E4%BA%BA%E4%BF%AE%E6%94%B9%E5%BC%80%E5%85%B3%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%8F%91%E5%B8%83%E5%AE%A1%E6%A0%B8",target:"_blank",rel:"noopener noreferrer"}},[a._v("namespace.lock.switch - 一次发布只能有一个人修改开关，用于发布审核"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("这是一个功能开关，如果配置为true的话，那么一次配置发布只能是一个人修改，另一个发布。")]),a._v(" "),s("blockquote",[s("p",[a._v("生产环境建议开启此选项")])]),a._v(" "),s("h1",{attrs:{id:"服务端配置说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端配置说明"}},[a._v("#")]),a._v(" 服务端配置说明")]),a._v(" "),s("blockquote",[s("p",[a._v("以下配置除了支持在数据库中配置以外，也支持通过-D参数、application.properties等配置，且-D参数、application.properties等优先级高于数据库中的配置")])]),a._v(" "),s("h2",{attrs:{id:"调整apolloportaldb配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整apolloportaldb配置"}},[a._v("#")]),a._v(" 调整ApolloPortalDB配置")]),a._v(" "),s("p",[a._v("配置项统一存储在ApolloPortalDB.ServerConfig表中，也可以通过"),s("code",[a._v("管理员工具 - 系统参数")]),a._v("页面进行配置，无特殊说明则修改完一分钟实时生效。")]),a._v(" "),s("h3",{attrs:{id:"apollo-portal-envs-可支持的环境列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apollo-portal-envs-可支持的环境列表"}},[a._v("#")]),a._v(" apollo.portal.envs - 可支持的环境列表")]),a._v(" "),s("p",[a._v("默认值是dev，如果portal需要管理多个环境的话，以逗号分隔即可（大小写不敏感），如：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DEV,FAT,UAT,PRO\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("名词解释：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("DEV(Development environment)\n开发环境，用于开发者调试使用\n\nFAT(Feature Acceptance Test environment)\n功能验收测试环境，用于软件测试者测试使用\n\nUAT(User Acceptance Test environment)\n用户验收测试环境，用于用户测试验收使用\n\nPRO(Production environment)\n生产环境\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br")])]),s("p",[a._v("修改完需要重启生效。")]),a._v(" "),s("blockquote",[s("p",[a._v("注1：一套Portal可以管理多个环境，但是每个环境都需要独立部署一套Config Service、Admin Service和ApolloConfigDB，具体请参考："),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_212-%E5%88%9B%E5%BB%BAapolloconfigdb",target:"_blank",rel:"noopener noreferrer"}},[a._v("2.1.2 创建ApolloConfigDB"),s("OutboundLink")],1),a._v("，"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_32-%E8%B0%83%E6%95%B4apolloconfigdb%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[a._v("3.2 调整ApolloConfigDB配置"),s("OutboundLink")],1),a._v("，"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_22112-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%BF%A1%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[a._v("2.2.1.1.2 配置数据库连接信息"),s("OutboundLink")],1),a._v("，另外如果是为已经运行了一段时间的Apollo配置中心增加环境，别忘了参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_2124-%E4%BB%8E%E5%88%AB%E7%9A%84%E7%8E%AF%E5%A2%83%E5%AF%BC%E5%85%A5apolloconfigdb%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%95%B0%E6%8D%AE",target:"_blank",rel:"noopener noreferrer"}},[a._v("2.1.2.4 从别的环境导入ApolloConfigDB的项目数据"),s("OutboundLink")],1),a._v("对新的环境做初始化。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注2：只在数据库添加环境是不起作用的，还需要为apollo-portal添加新增环境对应的meta server地址，具体参考："),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_221124-%E9%85%8D%E7%BD%AEapollo-portal%E7%9A%84meta-service%E4%BF%A1%E6%81%AF",target:"_blank",rel:"noopener noreferrer"}},[a._v("2.2.1.1.2.4 配置apollo-portal的meta service信息"),s("OutboundLink")],1),a._v("。apollo-client在新的环境下使用时也需要做好相应的配置，具体参考："),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/usage/java-sdk-user-guide?id=_122-apollo-meta-server",target:"_blank",rel:"noopener noreferrer"}},[a._v("1.2.2 Apollo Meta Server"),s("OutboundLink")],1),a._v("。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注3：如果希望添加自定义的环境名称，具体步骤可以参考"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase?id=_4-portal%E5%A6%82%E4%BD%95%E5%A2%9E%E5%8A%A0%E7%8E%AF%E5%A2%83%EF%BC%9F",target:"_blank",rel:"noopener noreferrer"}},[a._v("Portal如何增加环境"),s("OutboundLink")],1),a._v("。")])]),a._v(" "),s("blockquote",[s("p",[a._v("注4：1.1.0版本增加了系统信息页面（"),s("code",[a._v("管理员工具")]),a._v(" -> "),s("code",[a._v("系统信息")]),a._v("），可以通过该页面检查配置是否正确")])]),a._v(" "),s("h1",{attrs:{id:"多环境部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多环境部署"}},[a._v("#")]),a._v(" 多环境部署")]),a._v(" "),s("h2",{attrs:{id:"配置apollo-portal的meta-service信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置apollo-portal的meta-service信息"}},[a._v("#")]),a._v(" 配置apollo-portal的meta service信息")]),a._v(" "),s("p",[a._v("Apollo Portal需要在不同的环境访问不同的meta service(apollo-configservice)地址，所以我们需要在配置中提供这些信息。默认情况下，meta service和config service是部署在同一个JVM进程，所以meta service的地址就是config service的地址。")]),a._v(" "),s("blockquote",[s("p",[a._v("对于1.6.0及以上版本，可以通过ApolloPortalDB.ServerConfig中的配置项来配置Meta Service地址，详见"),s("a",{attrs:{href:"https://www.apolloconfig.com/#/zh/deployment/distributed-deployment-guide?id=_312-apolloportalmetaservers-%E5%90%84%E7%8E%AF%E5%A2%83meta-service%E5%88%97%E8%A1%A8",target:"_blank",rel:"noopener noreferrer"}},[a._v("apollo.portal.meta.servers - 各环境Meta Service列表"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("使用程序员专用编辑器（如vim，notepad++，sublime等）打开"),s("code",[a._v("apollo-portal-x.x.x-github.zip")]),a._v("中"),s("code",[a._v("config")]),a._v("目录下的"),s("code",[a._v("apollo-env.properties")]),a._v("文件。")]),a._v(" "),s("p",[a._v("假设DEV的apollo-configservice未绑定域名，地址是192.168.1.5:8080，PRO的apollo-configservice绑定了域名apollo.chuanqu.ltd，那么可以如下修改各环境meta service服务地址，格式为"),s("code",[a._v("${env}.meta=http://${config-service-url:port}")]),a._v("，如果某个环境不需要，也可以直接删除对应的配置项（如lpt.meta）：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("dev.meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://1.1.1.1:8080\nfat.meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://apollo.fat.xxx.com\nuat.meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://apollo.uat.xxx.com\npro.meta"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://apollo.xxx.com\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("除了通过"),s("code",[a._v("apollo-env.properties")]),a._v("方式配置meta service以外，apollo也支持在运行时指定meta service（优先级比"),s("code",[a._v("apollo-env.properties")]),a._v("高）：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("通过Java System Property")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("${env}_meta\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("可以通过Java的System Property "),s("code",[a._v("${env}_meta")]),a._v("来指定")]),a._v(" "),s("li",[a._v("如"),s("code",[a._v("java -Ddev_meta=http://config-service-url -jar xxx.jar")])]),a._v(" "),s("li",[a._v("也可以通过程序指定，如"),s("code",[a._v('System.setProperty("dev_meta", "http://config-service-url");')])])])]),a._v(" "),s("li",[s("p",[a._v("通过操作系统的System Environment")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("${ENV}_META\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("如"),s("code",[a._v("DEV_META=http://config-service-url")])]),a._v(" "),s("li",[a._v("注意key为全大写，且中间是"),s("code",[a._v("_")]),a._v("分隔")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("注1: 为了实现meta service的高可用，推荐通过SLB（Software Load Balancer）做动态负载均衡")])]),a._v(" "),s("blockquote",[s("p",[a._v("注2: meta service地址也可以填入IP，0.11.0版本之前只支持填入一个IP。从0.11.0版本开始支持填入以逗号分隔的多个地址（"),s("a",{attrs:{href:"https://github.com/apolloconfig/apollo/pull/1214",target:"_blank",rel:"noopener noreferrer"}},[a._v("PR #1214"),s("OutboundLink")],1),a._v("），如"),s("code",[a._v("http://1.1.1.1:8080,http://2.2.2.2:8080")]),a._v("，不过生产环境还是建议使用域名（走slb），因为机器扩容、缩容等都可能导致IP列表的变化。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);