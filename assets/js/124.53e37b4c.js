(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{707:function(s,a,t){"use strict";t.r(a);var r=t(17),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用docker搭建自己的dns服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用docker搭建自己的dns服务器"}},[s._v("#")]),s._v(" 使用Docker搭建自己的DNS服务器")]),s._v(" "),t("p",[s._v("在开发运维程中经常需要自定义一个域名来管理服务，通常的方法是修改hosts文件，但还有一种更便捷的方法，从源头上解决问题，也就是使用DNS来实现。")]),s._v(" "),t("h2",{attrs:{id:"_1-搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-搭建"}},[s._v("#")]),s._v(" "),t("strong",[s._v("1.搭建")])]),s._v(" "),t("p",[s._v("搭建依然使用docker，安装前请安装好docker的运行时环境。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 创建一个持久化存放文件的目录\nmkdir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind\n\n# 使用容器创建应用\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("udp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("publish "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("volume "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data \\\nsameersbn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.16")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20200524")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/d9946be6b57cf2cdf094c7a39b8a575d.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("默认占用53的tcp和udp的DNS访问端口，这个请不要更改，以及10000的管理面板端口。外网访问时，请在防火墙中放行此端口。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("firewall"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tcp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("permanent\nfirewall"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("udp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("permanent\nfirewall"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("reload\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_2-访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-访问"}},[s._v("#")]),s._v(" "),t("strong",[s._v("2.访问")])]),s._v(" "),t("p",[s._v("使用你的https://ip:10000在浏览器中打开。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/1d1bc11c8e4da26905b20bc05370f341.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("在高级内打开此网页，使用默认账户密码root/password登录。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/983724727b9f8b4473adb0aff81048f2.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("调整语言为中文，部分菜单可能仍会显示为英文。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/f38daaa0ae3bd17609c967cbeeef0278.png?aliyun",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"_3-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置"}},[s._v("#")]),s._v(" "),t("strong",[s._v("3.配置")])]),s._v(" "),t("p",[s._v("尝试绑定一下dns，依次点击图标中的例子。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/dda956d39390dcec506e21ac4a897b5b.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("任意填写一个名称，比如我以cn为域名后缀，填写邮箱，然后点击新建。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/1d55c58196f46573c7146b759cce8672.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("选择地址。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/4ffefbee877496d1e294c3af5c932420.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("填写域名和ip地址。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/bca1af51b7c3264628a4ffb634639e1a.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("可以看到我们的aaa.cn域名，已经解析到192.168.31.92这个ip上了。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/081b6d054a0267c29994ef25219ffb44.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("重启一下服务，执行以下命令，这样才能使用配置生效：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("docker restart bind\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"_4-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-使用"}},[s._v("#")]),s._v(" "),t("strong",[s._v("4.使用")])]),s._v(" "),t("p",[s._v("将电脑的dns地址指向服务器地址，比如我在Mac下修改DNS地址。Windows修改方式类似。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/4df99b99c59acbbcd77a8e71539c64f4.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("如果是公网就填公网地址。做一下ping测试，发现已经正常解析了。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/0c99cc9f93206027278053b9ba0d2289.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("到这个时候，其实还有一个问题，就是除了我们设置的域名之外的网站是无法访问的。如果想访问百度之类的公网网站，进行如下设置：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("vim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("resolv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("加入以下DNS地址：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("nameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".114")]),s._v("\nnameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("修改另一个配置文件：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("vim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("options\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("添加一行，内容如下：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("allow"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("query "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" any"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://imgoss.xgss.net/picgo/2b16bc99996c2e55483c527b5667389f.png?aliyun",alt:"img"}})]),s._v(" "),t("p",[s._v("再次重启一下bind服务，发现已经可以正常地访问互联网了，同时也能正常访问自定义的域名。")]),s._v(" "),t("p",[s._v("最后放上github的地址：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("hub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sameersbn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bind\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);