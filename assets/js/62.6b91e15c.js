(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{643:function(s,e,a){"use strict";a.r(e);var n=a(17),r=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[s._v("#")]),s._v(" Docker Compose")]),s._v(" "),a("h2",{attrs:{id:"compose-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-简介"}},[s._v("#")]),s._v(" Compose 简介")]),s._v(" "),a("p",[s._v("Docker Compose  是 Docker 官方编排（Orchestration）项目之一，负责快速在集群中部署分布式应用。")]),s._v(" "),a("p",[s._v("Docker Compose  项目是 Docker 官方的开源项目，负责实现对 Docker 容器集群的快速编排。从功能上看，跟  OpenStack  中的  Heat  十分类似。其代码目前在 https://github.com/docker/compose 上开源。")]),s._v(" "),a("p",[s._v("在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个 Web 项目，除了 Web 服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。")]),s._v(" "),a("p",[s._v("Compose允许用户通过一个单独的  docker-compose.yml  模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。")]),s._v(" "),a("p",[s._v("Compose  中有两个重要的概念：\n服务 ( service  )：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。\n项目 ( project  )：由一组关联的应用容器组成的一个完整业务单元，在  docker-compose.yml  文件中定义。")]),s._v(" "),a("p",[s._v("Docker for Mac  、 Docker for Windows  自带  docker-compose  二进制文件，安装 Docker 之\n后可以直接使用。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[www@node2 ~]$ docker-compose --version\ndocker-compose version 1.19.0, build 9e633ef\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"compose-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#compose-使用"}},[s._v("#")]),s._v(" Compose 使用")]),s._v(" "),a("h3",{attrs:{id:"术语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[s._v("#")]),s._v(" 术语")]),s._v(" "),a("p",[s._v("首先介绍几个术语。\n服务 ( service  )：一个应用容器，实际上可以运行多个相同镜像的实例。\n项目 ( project  )：由一组关联的应用容器组成的一个完整业务单元。\n可见，一个项目可以由多个服务（容器）关联而成， Compose  面向项目进行管理。")]),s._v(" "),a("h3",{attrs:{id:"场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[s._v("#")]),s._v(" 场景")]),s._v(" "),a("p",[s._v("最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。\n下面我们用  Python  来建立一个能够记录页面访问次数的 web 网站。")]),s._v(" "),a("p",[s._v("1.web 应用\n新建文件夹，在该目录中编写  app.py  文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir ~/python_web\nvi ~/python_web/app.py\n填写一下内容：\n\nfrom flask import Flask\nfrom redis import Redis\napp = Flask(__name__)\nredis = Redis(host='redis', port=6379)\n@app.route('/')\ndef hello():\ncount = redis.incr('hits')\nreturn 'Hello World! 该页面已被访问 {} 次。\\n'.format(count)\nif __name__ == \"__main__\":\napp.run(host=\"0.0.0.0\", debug=True)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("2.编写  Dockerfile  文件，内容为")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('vi ~/python_web/Dockerfile\n\nFROM python:3.6-alpine\nADD . /code\nWORKDIR /code\nRUN pip install redis flask\nCMD ["python", "app.py"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("3.编写  docker-compose.yml  文件\n这个是 Compose 使用的主模板文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('vi ~/python_web/docker-compose.yml\n\nversion: \'3\'\nservices:\nweb:\nbuild: .\nports:\n\t- "5000:5000"\nredis:\nimage: "redis:alpine"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("4.运行 compose 项目")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker-compose up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("报错：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[www@node2 ~]$ cd python_web/\n[www@node2 python_web]$ docker-compose up\nERROR: In file './docker-compose.yml', service must be a mapping, not a NoneType.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"一般步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一般步骤"}},[s._v("#")]),s._v(" 一般步骤")]),s._v(" "),a("p",[s._v("1、定义Dockerfile，方便迁移到任何地方；\n2、编写docker-compose.yml文件；\n3、运行"),a("code",[s._v("docker-compose up")]),s._v(" 启动服务")]),s._v(" "),a("p",[s._v("1.准备工作：提前下载好镜像：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker pull mysql \ndocker pull wordpress\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("2.需要新建一个空白目录，例如wptest。新建一个docker-compose.yml")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("version: '2'\nservices:\n    web: \n      image: wordpress:latest \n      links: \n        - db\n      ports: \n        - \"8002:80\"\n      environment:\n        WORDPRESS_DB_HOST: db:3306\n        WORDPRESS_DB_PASSWORD: 123456\n    db: \n      image: mysql \n      environment: \n        - MYSQL_ROOT_PASSWORD=123456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("3.以上命令的意思是新建db和wordpress容器。等同于：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker run --name db -e MYSQL_ROOT_PASSWORD=123456 -d mysql\n$ docker run --name some-wordpress --link db:mysql -p 8002:80 -d wordpress\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("4.好，我们启动应用：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ docker-compose up -d  #后台运行，\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[s._v("#")]),s._v(" 常用命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose  ps #命令查看状态\ndocker-compose  logs #查看日志\ndocker-compose stop #停止\ndocker-compose restart # 重启\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);